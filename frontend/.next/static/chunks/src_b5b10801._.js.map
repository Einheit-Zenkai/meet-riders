{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/services/partyMemberService.ts"],"sourcesContent":["// Service functions for party member operations\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport type { PartyMember } from \"../types\";\r\n\r\nexport class PartyMemberService {\r\n  private supabase = createClient();\r\n\r\n  /**\r\n   * Join a party as the current user\r\n   */\r\n  async joinParty(partyId: string, pickupNotes?: string): Promise<{ success: boolean; error?: string; member?: PartyMember }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) {\r\n        return { success: false, error: \"User not authenticated\" };\r\n      }\r\n\r\n      // Check if user can join the party using our helper function\r\n      const { data: canJoin, error: checkError } = await this.supabase\r\n        .rpc('can_user_join_party', { \r\n          p_party_id: partyId, \r\n          p_user_id: user.id \r\n        });\r\n\r\n      if (checkError) {\r\n        console.error('Error checking join eligibility:', checkError);\r\n        return { success: false, error: \"Failed to verify join eligibility\" };\r\n      }\r\n\r\n      if (!canJoin) {\r\n        return { success: false, error: \"Cannot join this party (full, expired, or already a member)\" };\r\n      }\r\n\r\n      // Join the party\r\n      const { data: memberRow, error: joinError } = await this.supabase\r\n        .from('party_members')\r\n        .insert({\r\n          party_id: partyId,\r\n          user_id: user.id,\r\n          status: 'joined',\r\n          pickup_notes: pickupNotes || null,\r\n          contact_shared: false\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (joinError) {\r\n        console.error('Error joining party:', joinError?.message || joinError);\r\n        return { success: false, error: \"Failed to join party\" };\r\n      }\r\n\r\n      if (!memberRow) {\r\n        return { success: false, error: \"Failed to join party\" };\r\n      }\r\n\r\n      // Fetch the member profile in a follow-up query to avoid relying on implicit FK relationships\r\n      let profile: Record<string, any> | null = null;\r\n      const { data: profileRow, error: profileError } = await this.supabase\r\n        .from('profiles')\r\n        .select('id, full_name, nickname, avatar_url, gender, points, university, show_university, phone_number, show_phone, created_at, updated_at, birth_date')\r\n        .eq('id', memberRow.user_id)\r\n        .single();\r\n\r\n      if (profileError) {\r\n        const errMsg = (profileError as any)?.message || (profileError as any)?.hint || JSON.stringify(profileError);\r\n        console.warn('Joined member profile fetch failed; continuing without profile details:', errMsg);\r\n      } else {\r\n        profile = profileRow;\r\n      }\r\n\r\n      // Transform the data to match our PartyMember type\r\n      const transformedMember: PartyMember = {\r\n        ...memberRow,\r\n        joined_at: new Date(memberRow.joined_at),\r\n        left_at: memberRow.left_at ? new Date(memberRow.left_at) : undefined,\r\n        created_at: new Date(memberRow.created_at),\r\n        updated_at: new Date(memberRow.updated_at),\r\n        profile: profile\r\n          ? {\r\n              ...profile,\r\n              created_at: profile.created_at ? new Date(profile.created_at) : null,\r\n              updated_at: profile.updated_at ? new Date(profile.updated_at) : null,\r\n              birth_date: profile.birth_date ? new Date(profile.birth_date) : null,\r\n            }\r\n          : undefined\r\n        \r\n      };\r\n\r\n      return { success: true, member: transformedMember };\r\n    } catch (error) {\r\n      console.error('Unexpected error joining party:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Leave a party as the current user\r\n   */\r\n  async leaveParty(partyId: string): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) {\r\n        return { success: false, error: \"User not authenticated\" };\r\n      }\r\n\r\n      // Update the member status to 'left'\r\n      const { error } = await this.supabase\r\n        .from('party_members')\r\n        .update({ \r\n          status: 'left', \r\n          left_at: new Date().toISOString() \r\n        })\r\n        .eq('party_id', partyId)\r\n        .eq('user_id', user.id)\r\n        .eq('status', 'joined');\r\n\r\n      if (error) {\r\n        console.error('Error leaving party:', error);\r\n        return { success: false, error: \"Failed to leave party\" };\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Unexpected error leaving party:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get party members for a specific party\r\n   */\r\n  async getPartyMembers(partyId: string): Promise<{ success: boolean; members?: PartyMember[]; error?: string }> {\r\n    try {\r\n      const { data: partyRow, error: partyError } = await this.supabase\r\n        .from('parties')\r\n        .select('host_id, created_at')\r\n        .eq('id', partyId)\r\n        .maybeSingle();\r\n\r\n      if (partyError) {\r\n        console.warn('Error fetching party host while loading members:', partyError);\r\n      }\r\n      const hostId: string | null = partyRow?.host_id ?? null;\r\n      const partyCreatedAt = partyRow?.created_at ? new Date(partyRow.created_at) : new Date();\r\n\r\n      // 1) Fetch raw members without cross-table joins to avoid RLS/relationship issues\r\n      const { data: memberRows, error: memberErr } = await this.supabase\r\n        .from('party_members')\r\n        .select('*')\r\n        .eq('party_id', partyId)\r\n        .eq('status', 'joined')\r\n        .order('joined_at', { ascending: true });\r\n\r\n      if (memberErr) {\r\n        const errMsg = (memberErr as any)?.message || (memberErr as any)?.hint || JSON.stringify(memberErr);\r\n        console.error('Error fetching party members (base rows):', errMsg);\r\n        return { success: false, error: 'Failed to fetch party members' };\r\n      }\r\n\r\n      const members = memberRows || [];\r\n      const userIds = members.map((m: any) => m.user_id).filter(Boolean);\r\n      if (hostId && !userIds.includes(hostId)) {\r\n        userIds.push(hostId);\r\n      }\r\n\r\n      // 2) If there are members, fetch their profiles in a second query\r\n      let profilesById: Record<string, any> = {};\r\n      if (userIds.length > 0) {\r\n        const { data: profiles, error: profileErr } = await this.supabase\r\n    .from('profiles')\r\n    .select('id, full_name, nickname, avatar_url, gender, points, university, show_university, phone_number, show_phone, created_at, updated_at, birth_date')\r\n          .in('id', userIds);\r\n\r\n        if (profileErr) {\r\n          const errMsg = (profileErr as any)?.message || (profileErr as any)?.hint || JSON.stringify(profileErr);\r\n          // If profiles are blocked by RLS, we still return members without profile to avoid hard failure\r\n          console.warn('Profiles fetch blocked or failed; continuing without profile details:', errMsg);\r\n        } else {\r\n          profilesById = (profiles || []).reduce((acc: Record<string, any>, p: any) => {\r\n            acc[p.id] = p;\r\n            return acc;\r\n          }, {});\r\n        }\r\n      }\r\n\r\n      const transformProfile = (profile: any) => {\r\n        if (!profile) return undefined;\r\n        return {\r\n          ...profile,\r\n          created_at: profile.created_at ? new Date(profile.created_at) : null,\r\n          updated_at: profile.updated_at ? new Date(profile.updated_at) : null,\r\n          birth_date: profile.birth_date ? new Date(profile.birth_date) : null,\r\n        };\r\n      };\r\n\r\n      // 3) Transform and attach profiles when available\r\n      const transformedMembers: PartyMember[] = members.map((member: any) => {\r\n        const profile = profilesById[member.user_id];\r\n        return {\r\n          ...member,\r\n          joined_at: new Date(member.joined_at),\r\n          left_at: member.left_at ? new Date(member.left_at) : undefined,\r\n          created_at: new Date(member.created_at),\r\n          updated_at: new Date(member.updated_at),\r\n          profile: transformProfile(profile),\r\n        };\r\n      });\r\n\r\n      if (hostId) {\r\n        const hostAlreadyIncluded = transformedMembers.some((member) => member.user_id === hostId);\r\n        if (!hostAlreadyIncluded) {\r\n          const hostProfile = transformProfile(profilesById[hostId]);\r\n          transformedMembers.unshift({\r\n            id: `host-${partyId}`,\r\n            party_id: partyId,\r\n            user_id: hostId,\r\n            status: 'joined',\r\n            joined_at: partyCreatedAt,\r\n            left_at: undefined,\r\n            pickup_notes: undefined,\r\n            contact_shared: false,\r\n            created_at: partyCreatedAt,\r\n            updated_at: partyCreatedAt,\r\n            profile: hostProfile,\r\n          });\r\n        }\r\n      }\r\n\r\n      return { success: true, members: transformedMembers };\r\n    } catch (error) {\r\n      console.error('Unexpected error fetching party members:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get member count for a party\r\n   */\r\n  async getPartyMemberCount(partyId: string): Promise<{ success: boolean; count?: number; error?: string }> {\r\n    try {\r\n      const { data: count, error } = await this.supabase\r\n  .rpc('get_party_member_count', { p_party_id: partyId });\r\n\r\n      if (error) {\r\n        console.error('Error getting member count:', error);\r\n        return { success: false, error: \"Failed to get member count\" };\r\n      }\r\n\r\n      return { success: true, count: count || 0 };\r\n    } catch (error) {\r\n      console.error('Unexpected error getting member count:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if current user is a member of a party\r\n   */\r\n  async isUserMember(partyId: string): Promise<{ success: boolean; isMember?: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) {\r\n        return { success: true, isMember: false };\r\n      }\r\n\r\n      const { data: membership, error } = await this.supabase\r\n        .from('party_members')\r\n        .select('id')\r\n        .eq('party_id', partyId)\r\n        .eq('user_id', user.id)\r\n        .eq('status', 'joined')\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') { // PGRST116 is \"not found\" error\r\n        console.error('Error checking membership:', error);\r\n        return { success: false, error: \"Failed to check membership\" };\r\n      }\r\n\r\n      return { success: true, isMember: !!membership };\r\n    } catch (error) {\r\n      console.error('Unexpected error checking membership:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /** Host-only: kick a member from a party via RPC */\r\n  async kickMember(partyId: string, memberUserId: string): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) return { success: false, error: 'Not authenticated' };\r\n      // Optional: sanity-check host authorization to avoid confusing RLS errors\r\n      const { data: partyRow, error: partyErr } = await this.supabase\r\n        .from('parties')\r\n        .select('host_id')\r\n        .eq('id', partyId)\r\n        .single();\r\n      if (partyErr) {\r\n        // Continue; RLS might block this but RPC may still work\r\n        console.warn('kickMember: failed to verify host_id, continuing to RPC:', (partyErr as any)?.message || partyErr);\r\n      } else if (partyRow && partyRow.host_id !== user.id) {\r\n        return { success: false, error: 'Only the host can kick members' };\r\n      }\r\n\r\n      // First try the generic RPC (may be overloaded in DB)\r\n      const { error } = await this.supabase.rpc('kick_party_member', {\r\n        p_party_id: partyId,\r\n        p_member_user_id: memberUserId,\r\n      });\r\n      if (!error) return { success: true };\r\n\r\n      const errMsg = (error as any)?.message || String(error);\r\n      // Handle ambiguous overload by trying a UUID-specific function if present\r\n      if (errMsg.toLowerCase().includes('choose the best candidate') || errMsg.toLowerCase().includes('ambiguous')) {\r\n        const { error: errUuid } = await this.supabase.rpc('kick_party_member_uuid' as any, {\r\n          p_party_id: partyId,\r\n          p_member_user_id: memberUserId,\r\n        });\r\n        if (!errUuid) return { success: true };\r\n        // Fallback: attempt a direct update if policies allow\r\n        const { error: updErr } = await this.supabase\r\n          .from('party_members')\r\n          .update({ status: 'kicked', left_at: new Date().toISOString() })\r\n          .eq('party_id', partyId)\r\n          .eq('user_id', memberUserId)\r\n          .eq('status', 'joined');\r\n        if (!updErr) return { success: true };\r\n        return { success: false, error: errUuid.message || updErr.message || 'Failed to kick member' };\r\n      }\r\n\r\n      return { success: false, error: errMsg };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Failed to kick member' };\r\n    }\r\n  }\r\n\r\n  /** Fetch pending join requests for parties hosted by the current user */\r\n  async getPendingRequestsForHost(): Promise<{\r\n    success: boolean;\r\n    requests?: Array<{ id: string; party_id: string; user_id: string; created_at: Date; userProfile?: any; party?: any }>;\r\n    error?: string;\r\n  }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) return { success: false, error: 'Not authenticated' };\r\n\r\n      let requests: any[] | null = null;\r\n      let lastError: any = null;\r\n      let partiesMap: Record<string, any> | null = null;\r\n\r\n      const rpcVariants = [\r\n        { p_host_id: user.id },\r\n        { host_id: user.id },\r\n        { p_host_uuid: user.id },\r\n        { host_uuid: user.id },\r\n        { host: user.id },\r\n        { user_id: user.id },\r\n      ];\r\n\r\n      for (const args of rpcVariants) {\r\n        const { data, error } = await this.supabase.rpc('get_pending_requests_for_host', args as any);\r\n        if (!error) {\r\n          requests = data || [];\r\n          lastError = null;\r\n          break;\r\n        }\r\n        lastError = error;\r\n      }\r\n\r\n      if (!requests) {\r\n        const { data, error } = await this.supabase.rpc('get_pending_requests_for_host');\r\n        if (!error) {\r\n          requests = data || [];\r\n          lastError = null;\r\n        } else {\r\n          lastError = error;\r\n        }\r\n      }\r\n\r\n      if (!requests && lastError) {\r\n        const nowIso = new Date().toISOString();\r\n        const { data: hostParties, error: partiesErr } = await this.supabase\r\n          .from('parties')\r\n          .select('id, drop_off, meetup_point, expires_at, is_active')\r\n          .eq('host_id', user.id)\r\n          .eq('is_active', true)\r\n          .gt('expires_at', nowIso);\r\n        if (partiesErr) {\r\n          console.error('getPendingRequestsForHost: fallback parties error:', partiesErr, 'rpc error:', lastError);\r\n          return { success: false, error: 'Failed to fetch requests' };\r\n        }\r\n\r\n        const partyIds = (hostParties || []).map((p: any) => p.id);\r\n        if (partyIds.length === 0) return { success: true, requests: [] };\r\n\r\n        const { data: reqRows, error: reqErr } = await this.supabase\r\n          .from('party_requests')\r\n          .select('request_id, party_id, user_id, created_at, status')\r\n          .in('party_id', partyIds)\r\n          .eq('status', 'pending')\r\n          .order('created_at', { ascending: true });\r\n\r\n        if (reqErr) {\r\n          console.error('getPendingRequestsForHost: fallback requests error:', reqErr, 'rpc error:', lastError);\r\n          return { success: false, error: 'Failed to fetch requests' };\r\n        }\r\n\r\n        requests = reqRows || [];\r\n        partiesMap = (hostParties || []).reduce((acc: Record<string, any>, p: any) => {\r\n          acc[String(p.id)] = p;\r\n          return acc;\r\n        }, {});\r\n      }\r\n\r\n      const requestsList = requests || [];\r\n      if (requestsList.length === 0) return { success: true, requests: [] };\r\n\r\n      // 3) Fetch profiles for requesters\r\n      const userIds = [...new Set(requestsList.map((r: any) => r.user_id))];\r\n      let profilesMap: Record<string, any> = {};\r\n      if (userIds.length > 0) {\r\n        const { data: profs } = await this.supabase\r\n          .from('profiles')\r\n          .select('id, full_name, nickname, avatar_url, gender, university, show_university, points')\r\n          .in('id', userIds);\r\n        (profs || []).forEach((p: any) => { profilesMap[p.id] = p; });\r\n      }\r\n\r\n      const enriched = requestsList.map((r: any) => {\r\n        const fallbackId = `${r.party_id}-${r.user_id}-${r.created_at || r.timestamp || Date.now()}`;\r\n        const partyDetails = partiesMap?.[String(r.party_id)] || r.party || null;\r\n        return {\r\n          id: String(r.id ?? r.request_id ?? fallbackId),\r\n          party_id: String(r.party_id),\r\n          user_id: String(r.user_id),\r\n          created_at: new Date(r.created_at || r.timestamp || Date.now()),\r\n          userProfile: profilesMap[String(r.user_id)],\r\n          party: {\r\n            drop_off: partyDetails?.drop_off ?? r.drop_off ?? null,\r\n            meetup_point: partyDetails?.meetup_point ?? r.meetup_point ?? null,\r\n          },\r\n        };\r\n      });\r\n      return { success: true, requests: enriched };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Failed to load requests' };\r\n    }\r\n  }\r\n\r\n  /** Host-only: approve a pending request */\r\n  async approveRequest(requestId: string, partyId: string, requesterId: string): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) return { success: false, error: 'Not authenticated' };\r\n\r\n      const normalizedRequestId = Number.isFinite(Number(requestId))\r\n        ? Number(requestId)\r\n        : requestId;\r\n\r\n      // Check eligibility via RPC (capacity/duplicate/expiry)\r\n      const { data: canJoin, error: checkError } = await this.supabase\r\n        .rpc('can_user_join_party', { p_party_id: partyId, p_user_id: requesterId });\r\n      if (checkError) {\r\n        console.error('approveRequest: can_user_join_party:', checkError);\r\n        return { success: false, error: 'Failed to verify capacity' };\r\n      }\r\n      if (!canJoin) return { success: false, error: 'Party full/expired or already a member' };\r\n\r\n      // Add as joined member\r\n      const { error: jErr } = await this.supabase\r\n        .from('party_members')\r\n        .insert({ party_id: partyId, user_id: requesterId, status: 'joined', contact_shared: false });\r\n      if (jErr) {\r\n        console.error('approveRequest: insert party_member:', jErr);\r\n        return { success: false, error: 'Failed to add member' };\r\n      }\r\n      // Mark request accepted\r\n      const { error: uErr } = await this.supabase\r\n        .from('party_requests')\r\n        .update({ status: 'accepted' })\r\n        .eq('request_id', normalizedRequestId);\r\n      if (uErr) console.warn('approveRequest: update request failed (non-blocking):', uErr);\r\n      return { success: true };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Approve failed' };\r\n    }\r\n  }\r\n\r\n  /** Host-only: decline a pending request */\r\n  async declineRequest(requestId: string): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const normalizedRequestId = Number.isFinite(Number(requestId))\r\n        ? Number(requestId)\r\n        : requestId;\r\n      const { error } = await this.supabase\r\n        .from('party_requests')\r\n        .update({ status: 'declined' })\r\n        .eq('request_id', normalizedRequestId);\r\n      if (error) return { success: false, error: error.message };\r\n      return { success: true };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Decline failed' };\r\n    }\r\n  }\r\n}\r\n\r\n// Export a singleton instance\r\nexport const partyMemberService = new PartyMemberService();\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 562, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card\"\r\n      className={cn(\r\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-header\"\r\n      className={cn(\r\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-title\"\r\n      className={cn(\"leading-none font-semibold\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-description\"\r\n      className={cn(\"text-muted-foreground text-sm\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-action\"\r\n      className={cn(\r\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-content\"\r\n      className={cn(\"px-6\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-footer\"\r\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport {\r\n  Card,\r\n  CardHeader,\r\n  CardFooter,\r\n  CardTitle,\r\n  CardAction,\r\n  CardDescription,\r\n  CardContent,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IACZ,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IAClB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,8JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IACjB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IACvB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IAClB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IACnB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IAClB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS","debugId":null}},
    {"offset": {"line": 684, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/stores/notificationsStore.ts"],"sourcesContent":["import { create } from \"zustand\";\r\n\r\nexport interface NotificationItem {\r\n  id: string; // make it unique e.g. `live-start:${partyId}` or `join-request:${requestId}`\r\n  message: string;\r\n  timestamp: Date;\r\n  read: boolean;\r\n  href?: string; // optional navigation target\r\n  // Optional categorization and payload for richer UIs (accept/decline buttons, etc.)\r\n  type?: 'join_request' | 'info' | 'success' | 'error';\r\n  meta?: Record<string, any>;\r\n}\r\n\r\ninterface NotificationsState {\r\n  notifications: NotificationItem[];\r\n  add: (n: NotificationItem) => void;\r\n  remove: (id: string) => void;\r\n  markRead: (id: string) => void;\r\n  markAllRead: () => void;\r\n  unreadCount: () => number;\r\n  has: (id: string) => boolean;\r\n}\r\n\r\nexport const useNotificationsStore = create<NotificationsState>((set, get) => ({\r\n  notifications: [],\r\n  add: (n) => set((state) => {\r\n    if (state.notifications.some((x) => x.id === n.id)) return state; // de-dup\r\n    return { notifications: [n, ...state.notifications] };\r\n  }),\r\n  remove: (id) => set((state) => ({\r\n    notifications: state.notifications.filter((n) => n.id !== id),\r\n  })),\r\n  markRead: (id) => set((state) => ({\r\n    notifications: state.notifications.map((n) => n.id === id ? { ...n, read: true } : n),\r\n  })),\r\n  markAllRead: () => set((state) => ({\r\n    notifications: state.notifications.map((n) => ({ ...n, read: true })),\r\n  })),\r\n  unreadCount: () => get().notifications.filter((n) => !n.read).length,\r\n  has: (id) => get().notifications.some((n) => n.id === id),\r\n}));\r\n"],"names":[],"mappings":";;;AAAA;;AAuBO,MAAM,wBAAwB,CAAA,GAAA,2IAAA,CAAA,SAAM,AAAD,EAAsB,CAAC,KAAK,MAAQ,CAAC;QAC7E,eAAe,EAAE;QACjB,KAAK,CAAC,IAAM,IAAI,CAAC;gBACf,IAAI,MAAM,aAAa,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,EAAE,EAAE,GAAG,OAAO,OAAO,SAAS;gBAC3E,OAAO;oBAAE,eAAe;wBAAC;2BAAM,MAAM,aAAa;qBAAC;gBAAC;YACtD;QACA,QAAQ,CAAC,KAAO,IAAI,CAAC,QAAU,CAAC;oBAC9B,eAAe,MAAM,aAAa,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;gBAC5D,CAAC;QACD,UAAU,CAAC,KAAO,IAAI,CAAC,QAAU,CAAC;oBAChC,eAAe,MAAM,aAAa,CAAC,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,KAAK;4BAAE,GAAG,CAAC;4BAAE,MAAM;wBAAK,IAAI;gBACrF,CAAC;QACD,aAAa,IAAM,IAAI,CAAC,QAAU,CAAC;oBACjC,eAAe,MAAM,aAAa,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;4BAAE,GAAG,CAAC;4BAAE,MAAM;wBAAK,CAAC;gBACrE,CAAC;QACD,aAAa,IAAM,MAAM,aAAa,CAAC,MAAM,CAAC,CAAC,IAAM,CAAC,EAAE,IAAI,EAAE,MAAM;QACpE,KAAK,CAAC,KAAO,MAAM,aAAa,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IACxD,CAAC","debugId":null}},
    {"offset": {"line": 727, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/components/GenderBadge.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Mars, Venus, User } from \"lucide-react\";\r\n\r\ntype Gender = string | null | undefined;\r\n\r\nexport function GenderBadge({ gender, className }: { gender: Gender; className?: string }) {\r\n  const g = (gender || \"\").toString().trim().toLowerCase();\r\n  let color = \"text-muted-foreground\";\r\n  let Icon: any = User;\r\n  let label = gender || \"\";\r\n\r\n  if (g === \"male\" || g === \"m\") {\r\n    color = \"text-sky-500\";\r\n  Icon = Mars;\r\n    label = \"Male\";\r\n  } else if (g === \"female\" || g === \"f\") {\r\n    color = \"text-pink-500\";\r\n  Icon = Venus;\r\n    label = \"Female\";\r\n  } else if (g === \"non-binary\" || g === \"nonbinary\" || g === \"they\" || g === \"they/them\" || g === \"nb\") {\r\n    color = \"text-zinc-400\";\r\n    Icon = User;\r\n    label = \"They/Them\";\r\n  } else if (g) {\r\n    // Some other custom input - keep gray\r\n    color = \"text-zinc-400\";\r\n    Icon = User;\r\n    label = gender as string;\r\n  } else {\r\n    color = \"text-zinc-400\";\r\n    Icon = User;\r\n    label = \"\";\r\n  }\r\n\r\n  return (\r\n    <span className={cn(\"inline-flex items-center gap-1 text-xs\", color, className)}>\r\n      <Icon className=\"h-3.5 w-3.5\" />\r\n      {label && <span>{label}</span>}\r\n    </span>\r\n  );\r\n}\r\n\r\nexport default GenderBadge;\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAHA;;;;AAOO,SAAS,YAAY,KAA6D;QAA7D,EAAE,MAAM,EAAE,SAAS,EAA0C,GAA7D;IAC1B,MAAM,IAAI,CAAC,UAAU,EAAE,EAAE,QAAQ,GAAG,IAAI,GAAG,WAAW;IACtD,IAAI,QAAQ;IACZ,IAAI,OAAY,qMAAA,CAAA,OAAI;IACpB,IAAI,QAAQ,UAAU;IAEtB,IAAI,MAAM,UAAU,MAAM,KAAK;QAC7B,QAAQ;QACV,OAAO,qMAAA,CAAA,OAAI;QACT,QAAQ;IACV,OAAO,IAAI,MAAM,YAAY,MAAM,KAAK;QACtC,QAAQ;QACV,OAAO,uMAAA,CAAA,QAAK;QACV,QAAQ;IACV,OAAO,IAAI,MAAM,gBAAgB,MAAM,eAAe,MAAM,UAAU,MAAM,eAAe,MAAM,MAAM;QACrG,QAAQ;QACR,OAAO,qMAAA,CAAA,OAAI;QACX,QAAQ;IACV,OAAO,IAAI,GAAG;QACZ,sCAAsC;QACtC,QAAQ;QACR,OAAO,qMAAA,CAAA,OAAI;QACX,QAAQ;IACV,OAAO;QACL,QAAQ;QACR,OAAO,qMAAA,CAAA,OAAI;QACX,QAAQ;IACV;IAEA,qBACE,6LAAC;QAAK,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,0CAA0C,OAAO;;0BACnE,6LAAC;gBAAK,WAAU;;;;;;YACf,uBAAS,6LAAC;0BAAM;;;;;;;;;;;;AAGvB;KAnCgB;uCAqCD","debugId":null}},
    {"offset": {"line": 805, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/NotificationsDropdown.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Bell } from \"lucide-react\";\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { useNotificationsStore } from \"@/stores/notificationsStore\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\n\r\nexport default function NotificationsDropdown() {\r\n  const [showDropdown, setShowDropdown] = useState(false);\r\n  const dropdownRef = useRef<HTMLDivElement>(null);\r\n  const router = useRouter();\r\n  const notifications = useNotificationsStore((s) => s.notifications);\r\n  const unreadCount = useNotificationsStore((s) => s.unreadCount());\r\n  const markRead = useNotificationsStore((s) => s.markRead);\r\n  const markAllRead = useNotificationsStore((s) => s.markAllRead);\r\n  const addNotification = useNotificationsStore((s) => s.add);\r\n  const removeNotification = useNotificationsStore((s) => s.remove);\r\n  const supabase = createClient();\r\n\r\n  // Close dropdown when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n        setShowDropdown(false);\r\n      }\r\n    };\r\n\r\n    if (showDropdown) {\r\n      document.addEventListener(\"mousedown\", handleClickOutside);\r\n      // Mark all as read when opening the dropdown so the red dot disappears\r\n      markAllRead();\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, [showDropdown, markAllRead]);\r\n\r\n  const onClickNotification = (id: string, href?: string) => {\r\n    markRead(id);\r\n    if (href) router.push(href);\r\n    setShowDropdown(false);\r\n  };\r\n\r\n  // Realtime: listen for join requests for hosts and acceptance/decline updates for requesters\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    (async () => {\r\n      const { data: auth } = await supabase.auth.getUser();\r\n      const currentUser = auth?.user;\r\n      if (!currentUser || !isMounted) return;\r\n\r\n      // Helper: fetch display name for a user\r\n      const getDisplayName = async (userId: string): Promise<string> => {\r\n        const { data: profile } = await supabase\r\n          .from('profiles')\r\n          .select('full_name, nickname')\r\n          .eq('id', userId)\r\n          .single();\r\n        return profile?.nickname || profile?.full_name || 'Someone';\r\n      };\r\n\r\n      // Helper: fetch party host id and short name/destination\r\n      const getPartyInfo = async (partyId: string) => {\r\n        const { data: party } = await supabase\r\n          .from('parties')\r\n          .select('id, host_id, drop_off')\r\n          .eq('id', partyId)\r\n          .single();\r\n        return party;\r\n      };\r\n\r\n      // Channel for party_requests changes\r\n      const channel = supabase\r\n        .channel('party-requests-notifs')\r\n        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'party_requests' }, async (payload) => {\r\n          // New request created; if I'm the host of that party, notify me\r\n          const rec: any = payload.new;\r\n          const party = await getPartyInfo(String(rec.party_id));\r\n          if (!party || party.host_id !== currentUser.id) return;\r\n          const requesterName = await getDisplayName(String(rec.user_id));\r\n          const notifId = `join-request:${rec.id || rec.request_id || rec.user_id + ':' + rec.party_id}`;\r\n          addNotification({\r\n            id: notifId,\r\n            message: `${requesterName} is trying to join your party`,\r\n            timestamp: new Date(),\r\n            read: false,\r\n            type: 'join_request',\r\n            meta: {\r\n              requestId: rec.id || rec.request_id,\r\n              partyId: String(rec.party_id),\r\n              requesterId: String(rec.user_id),\r\n              requesterName,\r\n            }\r\n          });\r\n        })\r\n        .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'party_requests' }, async (payload) => {\r\n          // Request updated; if I'm the requester, notify me on acceptance\r\n          const rec: any = payload.new;\r\n          if (String(rec.user_id) !== currentUser.id) return;\r\n          const party = await getPartyInfo(String(rec.party_id));\r\n          if (!party) return;\r\n          const hostName = await getDisplayName(String(party.host_id));\r\n          if (rec.status === 'accepted') {\r\n            addNotification({\r\n              id: `join-accepted:${rec.id || rec.request_id}`,\r\n              message: `You have joined ${hostName}'s party`,\r\n              timestamp: new Date(),\r\n              read: false,\r\n              type: 'success',\r\n              href: '/current-party',\r\n              meta: { partyId: String(rec.party_id) }\r\n            });\r\n          } else if (rec.status === 'declined') {\r\n            addNotification({\r\n              id: `join-declined:${rec.id || rec.request_id}`,\r\n              message: `${hostName} declined your join request`,\r\n              timestamp: new Date(),\r\n              read: false,\r\n              type: 'error',\r\n              meta: { partyId: String(rec.party_id) }\r\n            });\r\n          }\r\n        })\r\n        .subscribe();\r\n\r\n      return () => {\r\n        isMounted = false;\r\n        supabase.removeChannel(channel);\r\n      };\r\n    })();\r\n  }, [supabase, addNotification]);\r\n\r\n  const handleAccept = async (notifId: string, meta?: Record<string, any>) => {\r\n    if (!meta) return;\r\n    const { partyId, requesterId, requestId } = meta as any;\r\n    // Add requester as party member, then mark request accepted\r\n    const { error: insertErr } = await supabase\r\n      .from('party_members')\r\n      .insert({\r\n        party_id: partyId,\r\n        user_id: requesterId,\r\n        status: 'joined',\r\n        pickup_notes: null,\r\n        contact_shared: false,\r\n      });\r\n    if (insertErr) {\r\n      console.error('Failed to add requester to party:', insertErr);\r\n      return;\r\n    }\r\n    const updater = supabase.from('party_requests').update({ status: 'accepted' });\r\n    const normalizedRequestId = requestId && Number.isFinite(Number(requestId))\r\n      ? Number(requestId)\r\n      : requestId;\r\n    const { error: updateErr } = requestId\r\n      ? await updater.eq('request_id', normalizedRequestId).select()\r\n      : await updater.eq('party_id', partyId).eq('user_id', requesterId).select();\r\n    if (updateErr) {\r\n      console.error('Failed to update request status:', updateErr);\r\n      return;\r\n    }\r\n    removeNotification(notifId);\r\n  };\r\n\r\n  const handleDecline = async (notifId: string, meta?: Record<string, any>) => {\r\n    if (!meta) return;\r\n    const { partyId, requesterId, requestId } = meta as any;\r\n    const updater = supabase.from('party_requests').update({ status: 'declined' });\r\n    const normalizedRequestId = requestId && Number.isFinite(Number(requestId))\r\n      ? Number(requestId)\r\n      : requestId;\r\n    const { error } = requestId\r\n      ? await updater.eq('request_id', normalizedRequestId)\r\n      : await updater.eq('party_id', partyId).eq('user_id', requesterId);\r\n    if (error) {\r\n      console.error('Failed to decline request:', error);\r\n      return;\r\n    }\r\n    removeNotification(notifId);\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\" ref={dropdownRef}>\r\n      <button\r\n        className=\"p-2 rounded-full border hover:bg-accent hover:shadow-[0_0_20px_4px_rgba(255,43,99,0.35)] relative\"\r\n        title=\"Notifications\"\r\n        onClick={() => setShowDropdown(!showDropdown)}\r\n      >\r\n        <Bell className=\"w-5 h-5\" />\r\n        {unreadCount > 0 && (\r\n          <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\r\n            {unreadCount > 9 ? '9+' : unreadCount}\r\n          </span>\r\n        )}\r\n      </button>\r\n      \r\n      {showDropdown && (\r\n        <div className=\"absolute right-0 mt-2 w-80 rounded-md border bg-card/95 backdrop-blur shadow-lg z-50 max-h-96 overflow-y-auto\">\r\n          <div className=\"p-3 border-b\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <h3 className=\"font-semibold text-sm\">Notifications</h3>\r\n              {unreadCount > 0 && (\r\n                <button className=\"text-xs text-primary hover:underline\" onClick={() => markAllRead()}>Mark all read</button>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n          {notifications.length === 0 ? (\r\n            <div className=\"p-4 text-center text-sm text-muted-foreground\">\r\n              No notifications\r\n            </div>\r\n          ) : (\r\n            <div className=\"divide-y\">\r\n              {notifications.map((n) => (\r\n                <div\r\n                  key={n.id}\r\n                  className={`w-full text-left p-3 ${!n.read ? 'bg-accent/20' : ''}`}\r\n                >\r\n                  <div className=\"flex items-start justify-between gap-2\">\r\n                    <div className=\"flex-1\">\r\n                      <p className=\"text-sm\">{n.message}</p>\r\n                      <p className=\"text-xs text-muted-foreground mt-1\">\r\n                        {n.timestamp.toLocaleTimeString()}\r\n                      </p>\r\n                    </div>\r\n                    {n.type !== 'join_request' && (\r\n                      <button\r\n                        onClick={() => onClickNotification(n.id, n.href)}\r\n                        className=\"text-xs text-primary hover:underline\"\r\n                      >\r\n                        View\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                  {n.type === 'join_request' && (\r\n                    <div className=\"flex items-center gap-2 mt-2\">\r\n                      <button\r\n                        onClick={() => handleAccept(n.id, n.meta)}\r\n                        className=\"px-2 py-1 text-xs rounded border border-green-300 bg-green-100 text-green-800 hover:shadow-[0_0_12px_2px_rgba(16,185,129,0.45)]\"\r\n                        title=\"Accept\"\r\n                      >\r\n                        Accept\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDecline(n.id, n.meta)}\r\n                        className=\"px-2 py-1 text-xs rounded border border-red-300 bg-red-100 text-red-800 hover:shadow-[0_0_12px_2px_rgba(239,68,68,0.45)]\"\r\n                        title=\"Decline\"\r\n                      >\r\n                        Decline\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1214, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/current-party/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport useAuthStore from \"@/stores/authStore\";\r\nimport { partyMemberService } from \"../dashboard/services/partyMemberService\";\r\nimport type { Party, PartyMember, Profile } from \"../dashboard/types\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Crown, LogOut, UserX, Phone, Users, MapPin } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport { useNotificationsStore } from \"@/stores/notificationsStore\";\r\nimport GenderBadge from \"@/components/GenderBadge\";\r\nimport NotificationsDropdown from \"../dashboard/components/NotificationsDropdown\";\r\n\r\nexport default function CurrentPartyPage() {\r\n  const user = useAuthStore(state => state.user);\r\n  const authLoading = useAuthStore(state => state.loading);\r\n  const router = useRouter();\r\n  const supabase = useMemo(() => createClient(), []);\r\n  const addNotification = useNotificationsStore((s) => s.add);\r\n  const hasNotification = useNotificationsStore((s) => s.has);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [parties, setParties] = useState<Party[]>([]);\r\n  const [selectedId, setSelectedId] = useState<string | null>(null);\r\n  const [members, setMembers] = useState<PartyMember[]>([]);\r\n  const [hostProfile, setHostProfile] = useState<Profile | null>(null);\r\n  const [busy, setBusy] = useState(false);\r\n\r\n  const selectedParty = useMemo(\r\n    () => (selectedId ? parties.find(p => p.id === selectedId) || null : null),\r\n    [parties, selectedId]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!authLoading && !user) {\r\n      router.replace(\"/login\");\r\n    }\r\n  }, [authLoading, user, router]);\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      if (!user) return;\r\n      setLoading(true);\r\n      try {\r\n        // hosting party\r\n  const partyFields = `id, created_at, updated_at, host_id, party_size, duration_minutes, expires_at, meetup_point, drop_off, is_friends_only, is_gender_only, ride_options, host_comments, host_university, display_university, is_active`;\r\n\r\n        const { data: hosting, error: hostErr } = await supabase\r\n          .from('parties')\r\n          .select(partyFields)\r\n          .eq('host_id', user.id)\r\n          .eq('is_active', true);\r\n\r\n        if (hostErr) console.warn('host fetch error', hostErr);\r\n\r\n        // joined parties: get ids then fetch\r\n        const { data: myMemberRows, error: memErr } = await supabase\r\n          .from('party_members')\r\n          .select('party_id')\r\n          .eq('user_id', user.id)\r\n          .eq('status', 'joined');\r\n        if (memErr) console.warn('membership fetch error', memErr);\r\n\r\n        let joined: any[] = [];\r\n        const ids = (myMemberRows || []).map(r => r.party_id);\r\n        if (ids.length) {\r\n          const { data: joinedParties, error: joinedErr } = await supabase\r\n            .from('parties')\r\n            .select(partyFields)\r\n            .in('id', ids)\r\n            .eq('is_active', true);\r\n          if (joinedErr) console.warn('joined fetch error', joinedErr);\r\n          joined = joinedParties || [];\r\n        }\r\n\r\n        // merge unique by id\r\n        const mergedRaw = [...(hosting || []), ...joined]\r\n          .reduce((acc: any[], p: any) => acc.find(x => x.id === p.id) ? acc : acc.concat(p), []);\r\n\r\n        // map to Party shape (dates)\r\n        const casted: Party[] = mergedRaw.map((p: any) => ({\r\n          ...p,\r\n          created_at: new Date(p.created_at),\r\n          updated_at: p.updated_at ? new Date(p.updated_at) : new Date(p.created_at),\r\n          expires_at: new Date(p.expires_at),\r\n          ride_options: Array.isArray(p.ride_options) ? p.ride_options : [],\r\n          duration_minutes: typeof p.duration_minutes === 'number' ? p.duration_minutes : 0,\r\n          display_university: p.display_university,\r\n          is_active: p.is_active,\r\n        }));\r\n\r\n  setParties(casted);\r\n  setSelectedId((casted[0]?.id) ?? null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    load();\r\n  }, [user, supabase]);\r\n\r\n  useEffect(() => {\r\n    const loadDetails = async () => {\r\n      if (!selectedParty) return;\r\n      // Load members via service (RLS-safe) and compute excluding host\r\n      const res = await partyMemberService.getPartyMembers(selectedParty.id);\r\n      const memberList = res.success && res.members ? res.members : [];\r\n      setMembers(memberList);\r\n\r\n      // If party has reached time 0 and has at least 1 member (besides host), create a notification (no auto-redirect)\r\n  const now = Date.now();\r\n  // Add a small buffer to avoid client/DB clock skew\r\n  const expired = selectedParty.expires_at.getTime() <= (now - 2000);\r\n      const nonHostCount = memberList.filter(m => m.user_id !== selectedParty.host_id).length;\r\n      if (expired && nonHostCount > 0) {\r\n        const id = `live-start:${selectedParty.id}`;\r\n        if (!hasNotification(id)) {\r\n          addNotification({\r\n            id,\r\n            message: `${hostProfile?.nickname || hostProfile?.full_name || 'Host'}'s party has started for ${selectedParty.drop_off}. Click to open.`,\r\n            timestamp: new Date(),\r\n            read: false,\r\n            href: `/live-party?id=${selectedParty.id}`,\r\n          });\r\n          toast.info(\"Party started! Check the notification bell.\");\r\n        }\r\n      }\r\n      // load host profile for contact/university\r\n      const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('*')\r\n        .eq('id', selectedParty.host_id)\r\n        .maybeSingle();\r\n      if (profile) {\r\n        // normalize to Profile type\r\n        const norm: Profile = {\r\n          id: profile.id,\r\n          username: profile.username,\r\n          full_name: profile.full_name,\r\n          major: profile.major,\r\n          bio: profile.bio,\r\n          updated_at: profile.updated_at ? new Date(profile.updated_at) : null,\r\n          gender: profile.gender,\r\n          ideal_departure_time: profile.ideal_departure_time,\r\n          ideal_location: profile.ideal_location,\r\n          nickname: profile.nickname,\r\n          punctuality: profile.punctuality,\r\n          birth_date: profile.birth_date ? new Date(profile.birth_date) : null,\r\n          location: profile.location,\r\n          avatar_url: profile.avatar_url,\r\n          points: profile.points,\r\n          university: profile.university,\r\n          created_at: profile.created_at ? new Date(profile.created_at) : null,\r\n          show_university: profile.show_university,\r\n          phone_number: profile.phone_number,\r\n          show_phone: profile.show_phone,\r\n          isGenderOnly: null,\r\n          rideOptions: null,\r\n          expiresIn: null,\r\n        };\r\n        setHostProfile(norm);\r\n      } else {\r\n        setHostProfile(null);\r\n      }\r\n    };\r\n    loadDetails();\r\n  }, [selectedParty, supabase, router, addNotification, hasNotification, hostProfile]);\r\n\r\n  // Schedule a one-shot check right when the countdown reaches 0 to push a notification\r\n  useEffect(() => {\r\n    if (!selectedParty) return;\r\n  const msUntilExpiry = selectedParty.expires_at.getTime() - Date.now();\r\n    if (msUntilExpiry <= 0) return; // already handled by loadDetails above\r\n    const timer = setTimeout(async () => {\r\n      // Re-check members right at expiry time and exclude host explicitly\r\n      const res = await partyMemberService.getPartyMembers(selectedParty.id);\r\n      const memberList = res.success && res.members ? res.members : [];\r\n      const nonHostCount = memberList.filter(m => m.user_id !== selectedParty.host_id).length;\r\n      if (nonHostCount > 0) {\r\n        const id = `live-start:${selectedParty.id}`;\r\n        if (!hasNotification(id)) {\r\n          addNotification({\r\n            id,\r\n            message: `${hostProfile?.nickname || hostProfile?.full_name || 'Host'}'s party has started for ${selectedParty.drop_off}. Click to open.`,\r\n            timestamp: new Date(),\r\n            read: false,\r\n            href: `/live-party?id=${selectedParty.id}`,\r\n          });\r\n          toast.info(\"Party started! Check the notification bell.\");\r\n        }\r\n      }\r\n      // else: stay on current party per requirement\r\n    }, Math.min(msUntilExpiry + 100, 2_147_483_647)); // slight buffer, clamp to max setTimeout\r\n    return () => clearTimeout(timer);\r\n  }, [selectedParty, router, addNotification, hasNotification, hostProfile]);\r\n\r\n  const isHost = selectedParty && user && selectedParty.host_id === user.id;\r\n\r\n  const handleLeave = async () => {\r\n    if (!selectedParty || !user) return;\r\n    if (!confirm('Leave this party?')) return;\r\n    setBusy(true);\r\n    const res = await partyMemberService.leaveParty(selectedParty.id);\r\n    if (!res.success) toast.error(res.error || 'Failed to leave');\r\n    else {\r\n      toast.success('Left the party');\r\n      setParties(prev => prev.filter(p => p.id !== selectedParty.id));\r\n      setSelectedId(null);\r\n    }\r\n    setBusy(false);\r\n  };\r\n\r\n  const handleCancel = async () => {\r\n    if (!selectedParty || !isHost) return;\r\n    if (!confirm('Cancel this party for everyone?')) return;\r\n    setBusy(true);\r\n    const { error } = await supabase\r\n      .from('parties')\r\n      .update({ is_active: false })\r\n      .eq('id', selectedParty.id)\r\n      .eq('host_id', user!.id);\r\n    if (error) toast.error('Failed to cancel'); else {\r\n      toast.success('Party canceled');\r\n      setParties(prev => prev.filter(p => p.id !== selectedParty.id));\r\n      setSelectedId(null);\r\n    }\r\n    setBusy(false);\r\n  };\r\n\r\n  const handleKick = async (member: PartyMember) => {\r\n    if (!isHost) return;\r\n    const ok = confirm(`Kick ${member.profile?.nickname || member.profile?.full_name || 'this user'}?`);\r\n    if (!ok) return;\r\n    try {\r\n      setBusy(true);\r\n      const res = await partyMemberService.kickMember(selectedParty!.id, member.user_id);\r\n      if (!res.success) return toast.error(res.error || 'Failed to kick');\r\n      toast.success('Member removed');\r\n      setMembers(prev => prev.filter(m => m.user_id !== member.user_id));\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  };\r\n\r\n  const initials = (name?: string | null) => {\r\n    if (!name) return 'U';\r\n    return name.split(' ').map(w => w[0]?.toUpperCase()).slice(0,2).join('');\r\n  };\r\n\r\n  if (authLoading || loading) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <p className=\"text-muted-foreground\">Loading current parties</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (parties.length === 0) {\r\n    return (\r\n      <div className=\"p-6 space-y-6\">\r\n        <Button asChild variant=\"outline\"><Link href=\"/dashboard\"> Back</Link></Button>\r\n        <Card>\r\n          <CardContent className=\"py-12 text-center space-y-3\">\r\n            <h1 className=\"text-xl font-semibold\">No party in progress</h1>\r\n            <p className=\"text-muted-foreground\">You arent in any party right now.</p>\r\n            <Button asChild>\r\n              <Link href=\"/dashboard\">Browse parties</Link>\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <div className=\"mb-6 flex items-center justify-between\">\r\n        <Button asChild variant=\"outline\"><Link href=\"/dashboard\"> Back</Link></Button>\r\n        <h1 className=\"text-xl font-semibold\">Current Parties</h1>\r\n        <NotificationsDropdown />\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 xl:grid-cols-[320px_1fr] gap-6 items-start\">\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Your Active Parties</CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-2\">\r\n            {parties.length === 0 && (\r\n              <p className=\"text-sm text-muted-foreground\">You havent joined any parties yet.</p>\r\n            )}\r\n            {parties.map(p => (\r\n              <button\r\n                key={p.id}\r\n                onClick={() => setSelectedId(p.id)}\r\n                className={`w-full text-left p-3 rounded border transition ${selectedId === p.id ? 'bg-accent border-accent-foreground/20' : 'bg-background border-input hover:border-foreground/30'}`}\r\n              >\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"font-medium\">{p.drop_off}</div>\r\n                  <div className=\"text-xs text-muted-foreground\">{p.expires_at.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>\r\n                </div>\r\n                <div className=\"text-xs text-muted-foreground\">Meet: {p.meetup_point}</div>\r\n              </button>\r\n            ))}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <div>\r\n          {!selectedParty ? (\r\n            <Card>\r\n              <CardContent className=\"py-10 text-center text-muted-foreground\">Select a party to see details</CardContent>\r\n            </Card>\r\n          ) : (\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Ride to {selectedParty.drop_off}</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-6\">\r\n                {/* If expired and has non-host members, show a soft prompt instead of auto-redirect */}\r\n                {(() => {\r\n                  const expired = selectedParty.expires_at.getTime() <= (Date.now() - 2000);\r\n                  const nonHostCount = members.filter(m => m.user_id !== selectedParty.host_id).length;\r\n                  if (expired && nonHostCount > 0) {\r\n                    return (\r\n                      <div className=\"p-3 rounded border bg-amber-500/10 text-amber-200 text-sm flex items-center justify-between\">\r\n                        <span>Party has started. Open the live page from the notification bell.</span>\r\n                        <Button size=\"sm\" variant=\"secondary\" onClick={() => router.push(`/live-party?id=${selectedParty.id}`)}>Open Live Party</Button>\r\n                      </div>\r\n                    );\r\n                  }\r\n                  return null;\r\n                })()}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div className=\"flex items-center gap-3\"><MapPin size={18} /><span className=\"font-medium\">Meetup:</span> {selectedParty.meetup_point}</div>\r\n                  <div className=\"flex items-center gap-3\"><Users size={18} /><span className=\"font-medium\">Size:</span> {members.filter(m => m.user_id !== selectedParty.host_id).length}/{selectedParty.party_size}</div>\r\n                </div>\r\n\r\n                {selectedParty.host_comments && (\r\n                  <div className=\"p-3 rounded border bg-muted/30\">\r\n                    <div className=\"text-sm font-medium mb-1\">Host notes</div>\r\n                    <div className=\"text-sm text-muted-foreground whitespace-pre-wrap\">{selectedParty.host_comments}</div>\r\n                  </div>\r\n                )}\r\n\r\n                <div>\r\n                  <div className=\"mb-2 text-sm font-medium\">Members</div>\r\n                  <div className=\"flex flex-col divide-y border rounded\">\r\n                    {members.map(m => (\r\n                      <div key={m.id} className=\"flex items-center justify-between p-3\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <Link href={`/profile/id/${m.user_id}`} className=\"flex items-center\">\r\n                            <Avatar className=\"h-8 w-8\">\r\n                              <AvatarImage src={m.profile?.avatar_url || ''} />\r\n                              <AvatarFallback>{initials(m.profile?.nickname || m.profile?.full_name)}</AvatarFallback>\r\n                            </Avatar>\r\n                          </Link>\r\n                          <div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Link href={`/profile/id/${m.user_id}`} className=\"font-medium hover:underline\">{m.profile?.nickname || m.profile?.full_name || 'User'}</Link>\r\n                              {m.user_id === selectedParty.host_id && <Crown size={14} className=\"text-yellow-500\" />}\r\n                              {m.profile?.gender && (\r\n                                <GenderBadge gender={m.profile.gender} />\r\n                              )}\r\n                              {/* TODO: mutual friends button placeholder */}\r\n                            </div>\r\n                            {m.profile?.show_university && m.profile.university && (\r\n                              <div className=\"text-xs text-muted-foreground\">{m.profile.university}</div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        {isHost && m.user_id !== user!.id && (\r\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => handleKick(m)} disabled={busy}>\r\n                            <UserX className=\"h-4 w-4 mr-1\" /> Kick\r\n                          </Button>\r\n                        )}\r\n                      </div>\r\n                    ))}\r\n                    {members.length === 0 && <div className=\"p-3 text-sm text-muted-foreground\">No members yet.</div>}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center justify-between\">\r\n                  {!isHost ? (\r\n                    <Button variant=\"destructive\" onClick={handleLeave} disabled={busy}><LogOut className=\"h-4 w-4 mr-1\" /> Exit party</Button>\r\n                  ) : (\r\n                    <Button variant=\"destructive\" onClick={handleCancel} disabled={busy}>Cancel party</Button>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Host contact at bottom if enabled */}\r\n                {hostProfile?.show_phone && hostProfile.phone_number && (\r\n                  <div className=\"mt-6 flex items-center gap-2 text-sm p-3 rounded border bg-muted/20\">\r\n                    <Phone size={16} /> Host contact: <span className=\"font-medium\">{hostProfile.phone_number}</span>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}