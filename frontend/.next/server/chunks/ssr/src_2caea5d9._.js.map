{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/components/ui/hostbutton.tsx"],"sourcesContent":["import Link from \"next/link\";\r\nimport { Plus } from \"lucide-react\";\r\n\r\nexport default function HostButton() {\r\n  return (\r\n    <div className=\"fixed bottom-10 right-4 hidden sm:block sm:right-6 group z-[60]\">\r\n      <Link\r\n        href=\"/hostparty\"\r\n        className=\"relative flex h-20 w-20 items-center justify-center rounded-full border border-white/15 bg-slate-950/70 backdrop-blur-xl hover:bg-slate-950/50 hover:border-white/20\"\r\n      >\r\n        <Plus className=\"w-10 h-10 text-white/80\" />\r\n      </Link>\r\n      <div className=\"absolute bottom-1/2 right-full mr-4 flex translate-y-1/2 items-center px-3 py-1.5 bg-gray-900 text-white text-sm rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap\">\r\n        Host Ride\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAEe,SAAS;IACtB,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC,4JAAA,CAAA,UAAI;gBACH,MAAK;gBACL,WAAU;0BAEV,cAAA,8OAAC,kMAAA,CAAA,OAAI;oBAAC,WAAU;;;;;;;;;;;0BAElB,8OAAC;gBAAI,WAAU;0BAA4N;;;;;;;;;;;;AAKjP","debugId":null}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/stores/dashboardFiltersStore.ts"],"sourcesContent":["import { create } from \"zustand\";\r\n\r\nexport type TimeWindow = \"any\" | \"10\" | \"15\" | \"30\" | \"60\";\r\n\r\ninterface DashboardFiltersState {\r\n  destinationQuery: string;\r\n  timeWindowMins: TimeWindow;\r\n  sameDepartment: boolean;\r\n  sameYear: boolean;\r\n  showFriendsOnly: boolean;\r\n  showMyUniversityOnly: boolean;\r\n  setDestinationQuery: (value: string) => void;\r\n  setTimeWindowMins: (value: TimeWindow) => void;\r\n  setSameDepartment: (value: boolean) => void;\r\n  setSameYear: (value: boolean) => void;\r\n  setShowFriendsOnly: (value: boolean) => void;\r\n  setShowMyUniversityOnly: (value: boolean) => void;\r\n  resetFilters: () => void;\r\n}\r\n\r\nconst INITIAL_STATE: Omit<DashboardFiltersState,\r\n  | \"setDestinationQuery\"\r\n  | \"setTimeWindowMins\"\r\n  | \"setSameDepartment\"\r\n  | \"setSameYear\"\r\n  | \"setShowFriendsOnly\"\r\n  | \"setShowMyUniversityOnly\"\r\n  | \"resetFilters\"\r\n> = {\r\n  destinationQuery: \"\",\r\n  timeWindowMins: \"any\",\r\n  sameDepartment: false,\r\n  sameYear: false,\r\n  showFriendsOnly: false,\r\n  showMyUniversityOnly: false,\r\n};\r\n\r\nconst useDashboardFiltersStore = create<DashboardFiltersState>((set) => ({\r\n  ...INITIAL_STATE,\r\n  setDestinationQuery: (value) => set({ destinationQuery: value }),\r\n  setTimeWindowMins: (value) => set({ timeWindowMins: value }),\r\n  setSameDepartment: (value) => set({ sameDepartment: value }),\r\n  setSameYear: (value) => set({ sameYear: value }),\r\n  setShowFriendsOnly: (value) => set({ showFriendsOnly: value }),\r\n  setShowMyUniversityOnly: (value) => set({ showMyUniversityOnly: value }),\r\n  resetFilters: () => set(() => ({ ...INITIAL_STATE })),\r\n}));\r\n\r\nexport default useDashboardFiltersStore;\r\n"],"names":[],"mappings":";;;AAAA;;AAoBA,MAAM,gBAQF;IACF,kBAAkB;IAClB,gBAAgB;IAChB,gBAAgB;IAChB,UAAU;IACV,iBAAiB;IACjB,sBAAsB;AACxB;AAEA,MAAM,2BAA2B,CAAA,GAAA,wIAAA,CAAA,SAAM,AAAD,EAAyB,CAAC,MAAQ,CAAC;QACvE,GAAG,aAAa;QAChB,qBAAqB,CAAC,QAAU,IAAI;gBAAE,kBAAkB;YAAM;QAC9D,mBAAmB,CAAC,QAAU,IAAI;gBAAE,gBAAgB;YAAM;QAC1D,mBAAmB,CAAC,QAAU,IAAI;gBAAE,gBAAgB;YAAM;QAC1D,aAAa,CAAC,QAAU,IAAI;gBAAE,UAAU;YAAM;QAC9C,oBAAoB,CAAC,QAAU,IAAI;gBAAE,iBAAiB;YAAM;QAC5D,yBAAyB,CAAC,QAAU,IAAI;gBAAE,sBAAsB;YAAM;QACtE,cAAc,IAAM,IAAI,IAAM,CAAC;oBAAE,GAAG,aAAa;gBAAC,CAAC;IACrD,CAAC;uCAEc","debugId":null}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/SearchAndFilters.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Filter } from \"lucide-react\";\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport useDashboardFiltersStore, { TimeWindow } from \"@/stores/dashboardFiltersStore\";\r\n\r\nexport default function SearchAndFilters() {\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  const filtersRef = useRef<HTMLDivElement>(null);\r\n\r\n  const destinationQuery = useDashboardFiltersStore((state) => state.destinationQuery);\r\n  const setDestinationQuery = useDashboardFiltersStore((state) => state.setDestinationQuery);\r\n  const timeWindowMins = useDashboardFiltersStore((state) => state.timeWindowMins);\r\n  const setTimeWindowMins = useDashboardFiltersStore((state) => state.setTimeWindowMins);\r\n  const sameDepartment = useDashboardFiltersStore((state) => state.sameDepartment);\r\n  const setSameDepartment = useDashboardFiltersStore((state) => state.setSameDepartment);\r\n  const sameYear = useDashboardFiltersStore((state) => state.sameYear);\r\n  const setSameYear = useDashboardFiltersStore((state) => state.setSameYear);\r\n  const showFriendsOnly = useDashboardFiltersStore((state) => state.showFriendsOnly);\r\n  const setShowFriendsOnly = useDashboardFiltersStore((state) => state.setShowFriendsOnly);\r\n  const showMyUniversityOnly = useDashboardFiltersStore((state) => state.showMyUniversityOnly);\r\n  const setShowMyUniversityOnly = useDashboardFiltersStore((state) => state.setShowMyUniversityOnly);\r\n\r\n  // Close filters when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (filtersRef.current && !filtersRef.current.contains(event.target as Node)) {\r\n        setShowFilters(false);\r\n      }\r\n    };\r\n\r\n    if (showFilters) {\r\n      document.addEventListener(\"mousedown\", handleClickOutside);\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, [showFilters]);\r\n\r\n  return (\r\n    <div className=\"relative\" ref={filtersRef}>\r\n      <input\r\n        type=\"text\"\r\n        className=\"w-full px-5 py-3 pr-12 rounded-full bg-card/60 text-foreground placeholder:text-muted-foreground shadow-[0_4px_30px_rgba(0,0,0,0.12)] focus:outline-none focus:ring-2 focus:ring-primary/50 border border-white/10 backdrop-blur-[6px]\"\r\n        style={{ WebkitBackdropFilter: \"blur(2.2px)\" }}\r\n        placeholder=\"Search destination (e.g., MG Road, North Gate)\"\r\n        value={destinationQuery}\r\n        onChange={(e) => setDestinationQuery(e.target.value)}\r\n      />\r\n\r\n      {/* Button wrapper to anchor dropdown directly below the funnel icon */}\r\n      <div className=\"absolute right-1.5 top-1/2 -translate-y-1/2\">\r\n        <button\r\n          className=\"p-2 rounded-full hover:bg-foreground/10\"\r\n          title=\"Filters\"\r\n          onClick={() => setShowFilters(!showFilters)}\r\n        >\r\n          <Filter className=\"w-4 h-4 text-foreground\" />\r\n        </button>\r\n\r\n        {showFilters && (\r\n          <div\r\n            className=\"absolute top-full right-0 z-50 mt-2 w-80 rounded-xl border border-white/10 bg-card/60 shadow-lg backdrop-blur-[6px] p-3\"\r\n            style={{ WebkitBackdropFilter: \"blur(6px)\" }}\r\n          >\r\n            <div className=\"space-y-2\">\r\n              <label htmlFor=\"timeWindow\" className=\"text-sm font-medium text-muted-foreground\">\r\n                Expiring within\r\n              </label>\r\n              <select\r\n                id=\"timeWindow\"\r\n                className=\"w-full p-2 border rounded-full bg-background/70 text-foreground\"\r\n                value={timeWindowMins}\r\n                onChange={(e) => setTimeWindowMins(e.target.value as TimeWindow)}\r\n              >\r\n                <option value=\"any\">Any time</option>\r\n                <option value=\"10\">10 minutes</option>\r\n                <option value=\"15\">15 minutes</option>\r\n                <option value=\"30\">30 minutes</option>\r\n                <option value=\"60\">1 hour</option>\r\n              </select>\r\n\r\n              <div className=\"flex items-center gap-2 pt-1\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  disabled\r\n                  checked={sameDepartment}\r\n                  onChange={(e) => setSameDepartment(e.target.checked)}\r\n                />\r\n                <span className=\"text-sm text-muted-foreground\">Same department (coming soon)</span>\r\n              </div>\r\n\r\n              <div className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  disabled\r\n                  checked={sameYear}\r\n                  onChange={(e) => setSameYear(e.target.checked)}\r\n                />\r\n                <span className=\"text-sm text-muted-foreground\">Same year (coming soon)</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-2 pt-1\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={showFriendsOnly}\r\n                  onChange={e => setShowFriendsOnly(e.target.checked)}\r\n                />\r\n                <span className=\"text-sm text-foreground\">Connections&apos; Parties only</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={showMyUniversityOnly}\r\n                  onChange={e => setShowMyUniversityOnly(e.target.checked)}\r\n                />\r\n                <span className=\"text-sm text-foreground\">My University only</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 377, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/stores/notificationsStore.ts"],"sourcesContent":["import { create } from \"zustand\";\r\n\r\nexport interface NotificationItem {\r\n  id: string; // make it unique e.g. `live-start:${partyId}` or `join-request:${requestId}`\r\n  message: string;\r\n  timestamp: Date;\r\n  read: boolean;\r\n  href?: string; // optional navigation target\r\n  // Optional categorization and payload for richer UIs (accept/decline buttons, etc.)\r\n  type?: 'join_request' | 'info' | 'success' | 'error';\r\n  meta?: Record<string, any>;\r\n}\r\n\r\ninterface NotificationsState {\r\n  notifications: NotificationItem[];\r\n  add: (n: NotificationItem) => void;\r\n  remove: (id: string) => void;\r\n  markRead: (id: string) => void;\r\n  markAllRead: () => void;\r\n  unreadCount: () => number;\r\n  has: (id: string) => boolean;\r\n}\r\n\r\nexport const useNotificationsStore = create<NotificationsState>((set, get) => ({\r\n  notifications: [],\r\n  add: (n) => set((state) => {\r\n    if (state.notifications.some((x) => x.id === n.id)) return state; // de-dup\r\n    return { notifications: [n, ...state.notifications] };\r\n  }),\r\n  remove: (id) => set((state) => ({\r\n    notifications: state.notifications.filter((n) => n.id !== id),\r\n  })),\r\n  markRead: (id) => set((state) => ({\r\n    notifications: state.notifications.map((n) => n.id === id ? { ...n, read: true } : n),\r\n  })),\r\n  markAllRead: () => set((state) => ({\r\n    notifications: state.notifications.map((n) => ({ ...n, read: true })),\r\n  })),\r\n  unreadCount: () => get().notifications.filter((n) => !n.read).length,\r\n  has: (id) => get().notifications.some((n) => n.id === id),\r\n}));\r\n"],"names":[],"mappings":";;;AAAA;;AAuBO,MAAM,wBAAwB,CAAA,GAAA,wIAAA,CAAA,SAAM,AAAD,EAAsB,CAAC,KAAK,MAAQ,CAAC;QAC7E,eAAe,EAAE;QACjB,KAAK,CAAC,IAAM,IAAI,CAAC;gBACf,IAAI,MAAM,aAAa,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,EAAE,EAAE,GAAG,OAAO,OAAO,SAAS;gBAC3E,OAAO;oBAAE,eAAe;wBAAC;2BAAM,MAAM,aAAa;qBAAC;gBAAC;YACtD;QACA,QAAQ,CAAC,KAAO,IAAI,CAAC,QAAU,CAAC;oBAC9B,eAAe,MAAM,aAAa,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;gBAC5D,CAAC;QACD,UAAU,CAAC,KAAO,IAAI,CAAC,QAAU,CAAC;oBAChC,eAAe,MAAM,aAAa,CAAC,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,KAAK;4BAAE,GAAG,CAAC;4BAAE,MAAM;wBAAK,IAAI;gBACrF,CAAC;QACD,aAAa,IAAM,IAAI,CAAC,QAAU,CAAC;oBACjC,eAAe,MAAM,aAAa,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;4BAAE,GAAG,CAAC;4BAAE,MAAM;wBAAK,CAAC;gBACrE,CAAC;QACD,aAAa,IAAM,MAAM,aAAa,CAAC,MAAM,CAAC,CAAC,IAAM,CAAC,EAAE,IAAI,EAAE,MAAM;QACpE,KAAK,CAAC,KAAO,MAAM,aAAa,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IACxD,CAAC","debugId":null}},
    {"offset": {"line": 415, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/NotificationsDropdown.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Bell } from \"lucide-react\";\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { useNotificationsStore } from \"@/stores/notificationsStore\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\n\r\nexport default function NotificationsDropdown() {\r\n  const [showDropdown, setShowDropdown] = useState(false);\r\n  const dropdownRef = useRef<HTMLDivElement>(null);\r\n  const router = useRouter();\r\n  const notifications = useNotificationsStore((s) => s.notifications);\r\n  const unreadCount = useNotificationsStore((s) => s.unreadCount());\r\n  const markRead = useNotificationsStore((s) => s.markRead);\r\n  const markAllRead = useNotificationsStore((s) => s.markAllRead);\r\n  const addNotification = useNotificationsStore((s) => s.add);\r\n  const removeNotification = useNotificationsStore((s) => s.remove);\r\n  const supabase = createClient();\r\n\r\n  // Close dropdown when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n        setShowDropdown(false);\r\n      }\r\n    };\r\n\r\n    if (showDropdown) {\r\n      document.addEventListener(\"mousedown\", handleClickOutside);\r\n      // Mark all as read when opening the dropdown so the red dot disappears\r\n      markAllRead();\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, [showDropdown, markAllRead]);\r\n\r\n  const onClickNotification = (id: string, href?: string) => {\r\n    markRead(id);\r\n    if (href) router.push(href);\r\n    setShowDropdown(false);\r\n  };\r\n\r\n  // Realtime: listen for join requests for hosts and acceptance/decline updates for requesters\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    (async () => {\r\n      const { data: auth } = await supabase.auth.getUser();\r\n      const currentUser = auth?.user;\r\n      if (!currentUser || !isMounted) return;\r\n\r\n      // Helper: fetch display name for a user\r\n      const getDisplayName = async (userId: string): Promise<string> => {\r\n        const { data: profile } = await supabase\r\n          .from('profiles')\r\n          .select('full_name, nickname')\r\n          .eq('id', userId)\r\n          .single();\r\n        return profile?.nickname || profile?.full_name || 'Someone';\r\n      };\r\n\r\n      // Helper: fetch party host id and short name/destination\r\n      const getPartyInfo = async (partyId: string) => {\r\n        const { data: party } = await supabase\r\n          .from('parties')\r\n          .select('id, host_id, drop_off')\r\n          .eq('id', partyId)\r\n          .single();\r\n        return party;\r\n      };\r\n\r\n      // Channel for party_requests changes\r\n      const channel = supabase\r\n        .channel('party-requests-notifs')\r\n        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'party_requests' }, async (payload) => {\r\n          // New request created; if I'm the host of that party, notify me\r\n          const rec: any = payload.new;\r\n          const party = await getPartyInfo(String(rec.party_id));\r\n          if (!party || party.host_id !== currentUser.id) return;\r\n          const requesterName = await getDisplayName(String(rec.user_id));\r\n          const notifId = `join-request:${rec.id || rec.request_id || rec.user_id + ':' + rec.party_id}`;\r\n          addNotification({\r\n            id: notifId,\r\n            message: `${requesterName} is trying to join your party`,\r\n            timestamp: new Date(),\r\n            read: false,\r\n            type: 'join_request',\r\n            meta: {\r\n              requestId: rec.id || rec.request_id,\r\n              partyId: String(rec.party_id),\r\n              requesterId: String(rec.user_id),\r\n              requesterName,\r\n            }\r\n          });\r\n        })\r\n        .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'party_requests' }, async (payload) => {\r\n          // Request updated; if I'm the requester, notify me on acceptance\r\n          const rec: any = payload.new;\r\n          if (String(rec.user_id) !== currentUser.id) return;\r\n          const party = await getPartyInfo(String(rec.party_id));\r\n          if (!party) return;\r\n          const hostName = await getDisplayName(String(party.host_id));\r\n          if (rec.status === 'accepted') {\r\n            addNotification({\r\n              id: `join-accepted:${rec.id || rec.request_id}`,\r\n              message: `You have joined ${hostName}'s party`,\r\n              timestamp: new Date(),\r\n              read: false,\r\n              type: 'success',\r\n              href: '/current-party',\r\n              meta: { partyId: String(rec.party_id) }\r\n            });\r\n          } else if (rec.status === 'declined') {\r\n            addNotification({\r\n              id: `join-declined:${rec.id || rec.request_id}`,\r\n              message: `${hostName} declined your join request`,\r\n              timestamp: new Date(),\r\n              read: false,\r\n              type: 'error',\r\n              meta: { partyId: String(rec.party_id) }\r\n            });\r\n          }\r\n        })\r\n        .subscribe();\r\n\r\n      return () => {\r\n        isMounted = false;\r\n        supabase.removeChannel(channel);\r\n      };\r\n    })();\r\n  }, [supabase, addNotification]);\r\n\r\n  const handleAccept = async (notifId: string, meta?: Record<string, any>) => {\r\n    if (!meta) return;\r\n    const { partyId, requesterId, requestId } = meta as any;\r\n    // Add requester as party member, then mark request accepted\r\n    const { error: insertErr } = await supabase\r\n      .from('party_members')\r\n      .insert({\r\n        party_id: partyId,\r\n        user_id: requesterId,\r\n        status: 'joined',\r\n        pickup_notes: null,\r\n        contact_shared: false,\r\n      });\r\n    if (insertErr) {\r\n      console.error('Failed to add requester to party:', insertErr);\r\n      return;\r\n    }\r\n    const updater = supabase.from('party_requests').update({ status: 'accepted' });\r\n    const normalizedRequestId = requestId && Number.isFinite(Number(requestId))\r\n      ? Number(requestId)\r\n      : requestId;\r\n    const { error: updateErr } = requestId\r\n      ? await updater.eq('request_id', normalizedRequestId).select()\r\n      : await updater.eq('party_id', partyId).eq('user_id', requesterId).select();\r\n    if (updateErr) {\r\n      console.error('Failed to update request status:', updateErr);\r\n      return;\r\n    }\r\n    removeNotification(notifId);\r\n  };\r\n\r\n  const handleDecline = async (notifId: string, meta?: Record<string, any>) => {\r\n    if (!meta) return;\r\n    const { partyId, requesterId, requestId } = meta as any;\r\n    const updater = supabase.from('party_requests').update({ status: 'declined' });\r\n    const normalizedRequestId = requestId && Number.isFinite(Number(requestId))\r\n      ? Number(requestId)\r\n      : requestId;\r\n    const { error } = requestId\r\n      ? await updater.eq('request_id', normalizedRequestId)\r\n      : await updater.eq('party_id', partyId).eq('user_id', requesterId);\r\n    if (error) {\r\n      console.error('Failed to decline request:', error);\r\n      return;\r\n    }\r\n    removeNotification(notifId);\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\" ref={dropdownRef}>\r\n      <button\r\n        className=\"p-2 rounded-full border hover:bg-accent hover:shadow-[0_0_20px_4px_rgba(255,43,99,0.35)] relative\"\r\n        title=\"Notifications\"\r\n        onClick={() => setShowDropdown(!showDropdown)}\r\n      >\r\n        <Bell className=\"w-5 h-5\" />\r\n        {unreadCount > 0 && (\r\n          <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\r\n            {unreadCount > 9 ? '9+' : unreadCount}\r\n          </span>\r\n        )}\r\n      </button>\r\n      \r\n      {showDropdown && (\r\n        <div className=\"absolute right-0 mt-2 w-80 rounded-md border bg-card/95 backdrop-blur shadow-lg z-50 max-h-96 overflow-y-auto\">\r\n          <div className=\"p-3 border-b\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <h3 className=\"font-semibold text-sm\">Notifications</h3>\r\n              {unreadCount > 0 && (\r\n                <button className=\"text-xs text-primary hover:underline\" onClick={() => markAllRead()}>Mark all read</button>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n          {notifications.length === 0 ? (\r\n            <div className=\"p-4 text-center text-sm text-muted-foreground\">\r\n              No notifications\r\n            </div>\r\n          ) : (\r\n            <div className=\"divide-y\">\r\n              {notifications.map((n) => (\r\n                <div\r\n                  key={n.id}\r\n                  className={`w-full text-left p-3 ${!n.read ? 'bg-accent/20' : ''}`}\r\n                >\r\n                  <div className=\"flex items-start justify-between gap-2\">\r\n                    <div className=\"flex-1\">\r\n                      <p className=\"text-sm\">{n.message}</p>\r\n                      <p className=\"text-xs text-muted-foreground mt-1\">\r\n                        {n.timestamp.toLocaleTimeString()}\r\n                      </p>\r\n                    </div>\r\n                    {n.type !== 'join_request' && (\r\n                      <button\r\n                        onClick={() => onClickNotification(n.id, n.href)}\r\n                        className=\"text-xs text-primary hover:underline\"\r\n                      >\r\n                        View\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                  {n.type === 'join_request' && (\r\n                    <div className=\"flex items-center gap-2 mt-2\">\r\n                      <button\r\n                        onClick={() => handleAccept(n.id, n.meta)}\r\n                        className=\"px-2 py-1 text-xs rounded border border-green-300 bg-green-100 text-green-800 hover:shadow-[0_0_12px_2px_rgba(16,185,129,0.45)]\"\r\n                        title=\"Accept\"\r\n                      >\r\n                        Accept\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDecline(n.id, n.meta)}\r\n                        className=\"px-2 py-1 text-xs rounded border border-red-300 bg-red-100 text-red-800 hover:shadow-[0_0_12px_2px_rgba(239,68,68,0.45)]\"\r\n                        title=\"Decline\"\r\n                      >\r\n                        Decline\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 771, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/ThemeToggle.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Moon, Sun } from \"lucide-react\";\r\nimport { useState, useEffect } from \"react\";\r\n\r\nexport default function ThemeToggle() {\r\n  const [isDark, setIsDark] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Check initial theme\r\n    const isDarkMode = document.documentElement.classList.contains('dark');\r\n    setIsDark(isDarkMode);\r\n  }, []);\r\n\r\n  const toggleTheme = () => {\r\n    const newIsDark = !isDark;\r\n    setIsDark(newIsDark);\r\n    \r\n    if (newIsDark) {\r\n      document.documentElement.classList.add('dark');\r\n      localStorage.setItem('theme', 'dark');\r\n    } else {\r\n      document.documentElement.classList.remove('dark');\r\n      localStorage.setItem('theme', 'light');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <button\r\n      className=\"p-2 rounded-full border hover:bg-accent transition-colors\"\r\n      title={`Switch to ${isDark ? 'light' : 'dark'} mode`}\r\n      onClick={toggleTheme}\r\n    >\r\n      {isDark ? (\r\n        <Sun className=\"w-5 h-5\" />\r\n      ) : (\r\n        <Moon className=\"w-5 h-5\" />\r\n      )}\r\n    </button>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AAAA;AACA;AAHA;;;;AAKe,SAAS;IACtB,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAErC,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,sBAAsB;QACtB,MAAM,aAAa,SAAS,eAAe,CAAC,SAAS,CAAC,QAAQ,CAAC;QAC/D,UAAU;IACZ,GAAG,EAAE;IAEL,MAAM,cAAc;QAClB,MAAM,YAAY,CAAC;QACnB,UAAU;QAEV,IAAI,WAAW;YACb,SAAS,eAAe,CAAC,SAAS,CAAC,GAAG,CAAC;YACvC,aAAa,OAAO,CAAC,SAAS;QAChC,OAAO;YACL,SAAS,eAAe,CAAC,SAAS,CAAC,MAAM,CAAC;YAC1C,aAAa,OAAO,CAAC,SAAS;QAChC;IACF;IAEA,qBACE,8OAAC;QACC,WAAU;QACV,OAAO,CAAC,UAAU,EAAE,SAAS,UAAU,OAAO,KAAK,CAAC;QACpD,SAAS;kBAER,uBACC,8OAAC,gMAAA,CAAA,MAAG;YAAC,WAAU;;;;;iCAEf,8OAAC,kMAAA,CAAA,OAAI;YAAC,WAAU;;;;;;;;;;;AAIxB","debugId":null}},
    {"offset": {"line": 827, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/LogoutButton.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { LogOut } from \"lucide-react\";\r\nimport { useState } from \"react\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\n\r\nexport default function LogoutButton() {\r\n  const [showDialog, setShowDialog] = useState(false);\r\n  const [isLoggingOut, setIsLoggingOut] = useState(false);\r\n\r\n  const handleLogout = async () => {\r\n    setIsLoggingOut(true);\r\n    try {\r\n      const supabase = createClient();\r\n      await supabase.auth.signOut();\r\n      window.location.href = '/login';\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n      setIsLoggingOut(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        className=\"p-2 rounded-md border hover:bg-accent flex items-center gap-2 transition-colors\"\r\n        title=\"Log out\"\r\n        onClick={() => setShowDialog(true)}\r\n      >\r\n        <LogOut className=\"w-5 h-5\" />\r\n        <span className=\"hidden sm:inline\">Log out</span>\r\n      </button>\r\n\r\n      {/* Confirm dialog */}\r\n      {showDialog && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40\">\r\n          <div className=\"bg-card border rounded-lg shadow-lg w-full max-w-sm p-5\">\r\n            <h2 className=\"text-lg font-semibold mb-2\">Sign out</h2>\r\n            <p className=\"text-sm text-muted-foreground mb-4\">\r\n              Are you sure you want to log out?\r\n            </p>\r\n            <div className=\"flex justify-end gap-2\">\r\n              <button\r\n                className=\"px-4 py-2 rounded-md border hover:bg-accent transition-colors\"\r\n                onClick={() => setShowDialog(false)}\r\n                disabled={isLoggingOut}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                className=\"px-4 py-2 rounded-md bg-destructive text-destructive-foreground hover:bg-destructive/90 transition-colors disabled:opacity-50\"\r\n                onClick={handleLogout}\r\n                disabled={isLoggingOut}\r\n              >\r\n                {isLoggingOut ? 'Logging out...' : 'Yes, log out'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS;IACtB,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEjD,MAAM,eAAe;QACnB,gBAAgB;QAChB,IAAI;YACF,MAAM,WAAW,CAAA,GAAA,kIAAA,CAAA,eAAY,AAAD;YAC5B,MAAM,SAAS,IAAI,CAAC,OAAO;YAC3B,OAAO,QAAQ,CAAC,IAAI,GAAG;QACzB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,gBAAgB;QAClB;IACF;IAEA,qBACE;;0BACE,8OAAC;gBACC,WAAU;gBACV,OAAM;gBACN,SAAS,IAAM,cAAc;;kCAE7B,8OAAC,0MAAA,CAAA,SAAM;wBAAC,WAAU;;;;;;kCAClB,8OAAC;wBAAK,WAAU;kCAAmB;;;;;;;;;;;;YAIpC,4BACC,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCAA6B;;;;;;sCAC3C,8OAAC;4BAAE,WAAU;sCAAqC;;;;;;sCAGlD,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCACC,WAAU;oCACV,SAAS,IAAM,cAAc;oCAC7B,UAAU;8CACX;;;;;;8CAGD,8OAAC;oCACC,WAAU;oCACV,SAAS;oCACT,UAAU;8CAET,eAAe,mBAAmB;;;;;;;;;;;;;;;;;;;;;;;;;AAQnD","debugId":null}},
    {"offset": {"line": 949, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/DashboardHeader.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport SearchAndFilters from \"./SearchAndFilters\";\r\nimport NotificationsDropdown from \"./NotificationsDropdown\";\r\nimport ThemeToggle from \"./ThemeToggle\";\r\nimport LogoutButton from \"./LogoutButton\";\r\n\r\ninterface DashboardHeaderProps {\r\n  welcomeName: string | null;\r\n}\r\n\r\nexport default function DashboardHeader({ welcomeName }: DashboardHeaderProps) {\r\n  return (\r\n    <div className=\"flex flex-col gap-3 mb-4\">\r\n      <div className=\"flex items-center gap-3\">\r\n        <div className=\"flex-1\">\r\n          <SearchAndFilters />\r\n        </div>\r\n        <NotificationsDropdown />\r\n        <ThemeToggle />\r\n        <LogoutButton />\r\n      </div>\r\n\r\n      {/* Welcome message */}\r\n      <h1 className=\"text-2xl md:text-3xl font-bold text-foreground\">\r\n        {welcomeName ? `Welcome back, ${welcomeName}` : 'Meet Riders'}\r\n      </h1>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAWe,SAAS,gBAAgB,EAAE,WAAW,EAAwB;IAC3E,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,sKAAA,CAAA,UAAgB;;;;;;;;;;kCAEnB,8OAAC,2KAAA,CAAA,UAAqB;;;;;kCACtB,8OAAC,iKAAA,CAAA,UAAW;;;;;kCACZ,8OAAC,kKAAA,CAAA,UAAY;;;;;;;;;;;0BAIf,8OAAC;gBAAG,WAAU;0BACX,cAAc,CAAC,cAAc,EAAE,aAAa,GAAG;;;;;;;;;;;;AAIxD","debugId":null}},
    {"offset": {"line": 1022, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card\"\r\n      className={cn(\r\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-header\"\r\n      className={cn(\r\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-title\"\r\n      className={cn(\"leading-none font-semibold\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-description\"\r\n      className={cn(\"text-muted-foreground text-sm\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-action\"\r\n      className={cn(\r\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-content\"\r\n      className={cn(\"px-6\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-footer\"\r\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport {\r\n  Card,\r\n  CardHeader,\r\n  CardFooter,\r\n  CardTitle,\r\n  CardAction,\r\n  CardDescription,\r\n  CardContent,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,8JACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf","debugId":null}},
    {"offset": {"line": 1117, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/stores/dashboardDataStore.ts"],"sourcesContent":["import { create } from \"zustand\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport useAuthStore from \"@/stores/authStore\";\r\nimport type { Party, Profile } from \"@/app/(main)/dashboard/types\";\r\n\r\nexport type RefreshProfileStatus = \"no-user\" | \"ok\" | \"needs-onboarding\" | \"error\";\r\nexport type RefreshPartiesStatus = \"no-user\" | \"ok\" | \"error\";\r\n\r\ninterface DashboardDataState {\r\n  welcomeName: string | null;\r\n  viewerUniversity: string | null;\r\n  parties: Party[];\r\n  partiesLoading: boolean;\r\n  isCheckingProfile: boolean;\r\n  refreshProfile: () => Promise<RefreshProfileStatus>;\r\n  refreshParties: () => Promise<RefreshPartiesStatus>;\r\n  reset: () => void;\r\n}\r\n\r\nconst initialState: Omit<DashboardDataState, \"refreshProfile\" | \"refreshParties\" | \"reset\"> = {\r\n  welcomeName: null,\r\n  viewerUniversity: null,\r\n  parties: [],\r\n  partiesLoading: true,\r\n  isCheckingProfile: true,\r\n};\r\n\r\nconst useDashboardDataStore = create<DashboardDataState>((set, get) => ({\r\n  ...initialState,\r\n  refreshProfile: async () => {\r\n    const user = useAuthStore.getState().user;\r\n    if (!user) {\r\n      set({ ...initialState, partiesLoading: false, isCheckingProfile: false });\r\n      return \"no-user\";\r\n    }\r\n\r\n    set({ isCheckingProfile: true });\r\n\r\n    try {\r\n      const supabase = createClient();\r\n      const { data: profile, error } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"nickname, full_name, university\")\r\n        .eq(\"id\", user.id)\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error(\"Error fetching profile:\", error);\r\n        set({ welcomeName: null, viewerUniversity: null, isCheckingProfile: false });\r\n        return \"error\";\r\n      }\r\n\r\n      if (!profile || (!profile.nickname && !profile.full_name)) {\r\n        set({ welcomeName: null, viewerUniversity: null, isCheckingProfile: false });\r\n        return \"needs-onboarding\";\r\n      }\r\n\r\n      set({\r\n        welcomeName: profile.nickname || profile.full_name || \"Rider\",\r\n        viewerUniversity: profile.university || null,\r\n        isCheckingProfile: false,\r\n      });\r\n\r\n      return \"ok\";\r\n    } catch (error) {\r\n      console.error(\"Profile check failed:\", error);\r\n      set({ welcomeName: null, viewerUniversity: null, isCheckingProfile: false });\r\n      return \"error\";\r\n    }\r\n  },\r\n  refreshParties: async () => {\r\n    const user = useAuthStore.getState().user;\r\n    if (!user) {\r\n      set({ parties: [], partiesLoading: false });\r\n      return \"no-user\";\r\n    }\r\n\r\n    set({ partiesLoading: true });\r\n\r\n    try {\r\n      const supabase = createClient();\r\n\r\n      const nowIso = new Date().toISOString();\r\n\r\n      const { data: partiesData, error } = await supabase\r\n        .from(\"parties\")\r\n        .select(`\r\n          id,\r\n          created_at,\r\n          updated_at,\r\n          host_id,\r\n          party_size,\r\n          duration_minutes,\r\n          expires_at,\r\n          meetup_point,\r\n          drop_off,\r\n          is_friends_only,\r\n          is_gender_only,\r\n          ride_options,\r\n          host_comments,\r\n          host_university,\r\n          display_university,\r\n          is_active\r\n        `)\r\n        .eq(\"is_active\", true)\r\n        .gt(\"expires_at\", nowIso)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) {\r\n        console.error(\"Error fetching parties:\", (error as any)?.message || error);\r\n        set({ parties: [], partiesLoading: false });\r\n        return \"error\";\r\n      }\r\n\r\n      if (!partiesData || partiesData.length === 0) {\r\n        set({ parties: [], partiesLoading: false });\r\n        return \"ok\";\r\n      }\r\n\r\n      const hostIds = [...new Set(partiesData.map((party) => party.host_id))];\r\n\r\n      // Determine which hosts are \"connections\" with the viewer (either direction)\r\n      const connectedHostIds = new Set<string>();\r\n      if (hostIds.length > 0) {\r\n        const { data: relFromMe } = await supabase\r\n          .from(\"user_relationships\")\r\n          .select(\"receiver_id, status\")\r\n          .eq(\"initiator_id\", user.id)\r\n          .in(\"receiver_id\", hostIds)\r\n          .eq(\"status\", \"connected\");\r\n        relFromMe?.forEach((r: any) => connectedHostIds.add(r.receiver_id));\r\n\r\n        const { data: relToMe } = await supabase\r\n          .from(\"user_relationships\")\r\n          .select(\"initiator_id, status\")\r\n          .eq(\"receiver_id\", user.id)\r\n          .in(\"initiator_id\", hostIds)\r\n          .eq(\"status\", \"connected\");\r\n        relToMe?.forEach((r: any) => connectedHostIds.add(r.initiator_id));\r\n      }\r\n\r\n      // Enforce visibility: connections-only parties appear only if viewer is connected to host\r\n      const visiblePartiesData = (partiesData || []).filter((p: any) => {\r\n        return !p.is_friends_only || connectedHostIds.has(p.host_id);\r\n      });\r\n\r\n      const { data: profilesData, error: profilesError } = await supabase\r\n        .from(\"profiles\")\r\n        .select(`\r\n          id,\r\n          full_name,\r\n          nickname,\r\n          gender,\r\n          avatar_url,\r\n          university,\r\n          points,\r\n          phone_number,\r\n          show_phone,\r\n          major,\r\n          bio\r\n        `)\r\n        .in(\"id\", hostIds);\r\n\r\n      if (profilesError) {\r\n        console.error(\"Error fetching profiles:\", (profilesError as any)?.message || profilesError);\r\n      }\r\n\r\n      const profilesMap = new Map<string, Profile>();\r\n      profilesData?.forEach((profile) => {\r\n        profilesMap.set(profile.id, profile as Profile);\r\n      });\r\n\r\n  const partyIds = visiblePartiesData.map((party) => party.id as string);\r\n\r\n      const memberCounts = await Promise.all(\r\n        partyIds.map(async (partyId) => {\r\n          const { data: count } = await supabase.rpc(\"get_party_member_count\", { p_party_id: partyId });\r\n          return { partyId, count: count || 0 };\r\n        })\r\n      );\r\n\r\n      const memberCountsMap = new Map<string, number>();\r\n      memberCounts.forEach(({ partyId, count }) => {\r\n        memberCountsMap.set(partyId, count);\r\n      });\r\n\r\n      const { data: userMemberships } = await supabase\r\n        .from(\"party_members\")\r\n        .select(\"party_id\")\r\n        .eq(\"user_id\", user.id)\r\n        .eq(\"status\", \"joined\")\r\n        .in(\"party_id\", partyIds);\r\n\r\n      const userMembershipSet = new Set<string>(\r\n        userMemberships?.map((membership) => membership.party_id) || []\r\n      );\r\n\r\n      const transformedParties = visiblePartiesData.map((party) => {\r\n        const baseCount = memberCountsMap.get(party.id) || 0;\r\n        const viewerIsHost = party.host_id === user.id;\r\n        const viewerIsMember = viewerIsHost || userMembershipSet.has(party.id);\r\n        // Show members excluding host in the main feed to align with join capacity display, but keep track that hosts count separately elsewhere.\r\n        const visibleCount = baseCount;\r\n\r\n        return {\r\n        ...party,\r\n        created_at: new Date(party.created_at),\r\n        updated_at: party.updated_at ? new Date(party.updated_at) : new Date(party.created_at),\r\n        expires_at: party.expires_at ? new Date(party.expires_at) : new Date(),\r\n        ride_options: Array.isArray(party.ride_options) ? party.ride_options : [],\r\n        is_active: Boolean(party.is_active),\r\n        display_university: Boolean(party.display_university),\r\n        host_profile: profilesMap.get(party.host_id),\r\n          current_member_count: visibleCount,\r\n        user_is_member: viewerIsMember,\r\n      };\r\n      }) as Party[];\r\n\r\n      set({ parties: transformedParties, partiesLoading: false });\r\n      return \"ok\";\r\n    } catch (error) {\r\n      try {\r\n        console.error(\"Failed to fetch parties:\", (error as any)?.message || JSON.stringify(error));\r\n      } catch {\r\n        console.error(\"Failed to fetch parties:\", error);\r\n      }\r\n      set({ parties: [], partiesLoading: false });\r\n      return \"error\";\r\n    }\r\n  },\r\n  reset: () => {\r\n    set({ ...initialState, partiesLoading: false, isCheckingProfile: false });\r\n  },\r\n}));\r\n\r\nexport default useDashboardDataStore;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1335, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/services/partyMemberService.ts"],"sourcesContent":["// Service functions for party member operations\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport type { PartyMember } from \"../types\";\r\n\r\nexport class PartyMemberService {\r\n  private supabase = createClient();\r\n\r\n  /**\r\n   * Join a party as the current user\r\n   */\r\n  async joinParty(partyId: string, pickupNotes?: string): Promise<{ success: boolean; error?: string; member?: PartyMember }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) {\r\n        return { success: false, error: \"User not authenticated\" };\r\n      }\r\n\r\n      // Check if user can join the party using our helper function\r\n      const { data: canJoin, error: checkError } = await this.supabase\r\n        .rpc('can_user_join_party', { \r\n          p_party_id: partyId, \r\n          p_user_id: user.id \r\n        });\r\n\r\n      if (checkError) {\r\n        console.error('Error checking join eligibility:', checkError);\r\n        return { success: false, error: \"Failed to verify join eligibility\" };\r\n      }\r\n\r\n      if (!canJoin) {\r\n        return { success: false, error: \"Cannot join this party (full, expired, or already a member)\" };\r\n      }\r\n\r\n      // Join the party\r\n      const { data: memberRow, error: joinError } = await this.supabase\r\n        .from('party_members')\r\n        .insert({\r\n          party_id: partyId,\r\n          user_id: user.id,\r\n          status: 'joined',\r\n          pickup_notes: pickupNotes || null,\r\n          contact_shared: false\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (joinError) {\r\n        console.error('Error joining party:', joinError?.message || joinError);\r\n        return { success: false, error: \"Failed to join party\" };\r\n      }\r\n\r\n      if (!memberRow) {\r\n        return { success: false, error: \"Failed to join party\" };\r\n      }\r\n\r\n      // Fetch the member profile in a follow-up query to avoid relying on implicit FK relationships\r\n      let profile: Record<string, any> | null = null;\r\n      const { data: profileRow, error: profileError } = await this.supabase\r\n        .from('profiles')\r\n        .select('id, full_name, nickname, avatar_url, gender, points, university, show_university, phone_number, show_phone, created_at, updated_at, birth_date')\r\n        .eq('id', memberRow.user_id)\r\n        .single();\r\n\r\n      if (profileError) {\r\n        const errMsg = (profileError as any)?.message || (profileError as any)?.hint || JSON.stringify(profileError);\r\n        console.warn('Joined member profile fetch failed; continuing without profile details:', errMsg);\r\n      } else {\r\n        profile = profileRow;\r\n      }\r\n\r\n      // Transform the data to match our PartyMember type\r\n      const transformedMember: PartyMember = {\r\n        ...memberRow,\r\n        joined_at: new Date(memberRow.joined_at),\r\n        left_at: memberRow.left_at ? new Date(memberRow.left_at) : undefined,\r\n        created_at: new Date(memberRow.created_at),\r\n        updated_at: new Date(memberRow.updated_at),\r\n        profile: profile\r\n          ? {\r\n              ...profile,\r\n              created_at: profile.created_at ? new Date(profile.created_at) : null,\r\n              updated_at: profile.updated_at ? new Date(profile.updated_at) : null,\r\n              birth_date: profile.birth_date ? new Date(profile.birth_date) : null,\r\n            }\r\n          : undefined\r\n        \r\n      };\r\n\r\n      return { success: true, member: transformedMember };\r\n    } catch (error) {\r\n      console.error('Unexpected error joining party:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Leave a party as the current user\r\n   */\r\n  async leaveParty(partyId: string): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) {\r\n        return { success: false, error: \"User not authenticated\" };\r\n      }\r\n\r\n      // Update the member status to 'left'\r\n      const { error } = await this.supabase\r\n        .from('party_members')\r\n        .update({ \r\n          status: 'left', \r\n          left_at: new Date().toISOString() \r\n        })\r\n        .eq('party_id', partyId)\r\n        .eq('user_id', user.id)\r\n        .eq('status', 'joined');\r\n\r\n      if (error) {\r\n        console.error('Error leaving party:', error);\r\n        return { success: false, error: \"Failed to leave party\" };\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Unexpected error leaving party:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get party members for a specific party\r\n   */\r\n  async getPartyMembers(partyId: string): Promise<{ success: boolean; members?: PartyMember[]; error?: string }> {\r\n    try {\r\n      const { data: partyRow, error: partyError } = await this.supabase\r\n        .from('parties')\r\n        .select('host_id, created_at')\r\n        .eq('id', partyId)\r\n        .maybeSingle();\r\n\r\n      if (partyError) {\r\n        console.warn('Error fetching party host while loading members:', partyError);\r\n      }\r\n      const hostId: string | null = partyRow?.host_id ?? null;\r\n      const partyCreatedAt = partyRow?.created_at ? new Date(partyRow.created_at) : new Date();\r\n\r\n      // 1) Fetch raw members without cross-table joins to avoid RLS/relationship issues\r\n      const { data: memberRows, error: memberErr } = await this.supabase\r\n        .from('party_members')\r\n        .select('*')\r\n        .eq('party_id', partyId)\r\n        .eq('status', 'joined')\r\n        .order('joined_at', { ascending: true });\r\n\r\n      if (memberErr) {\r\n        const errMsg = (memberErr as any)?.message || (memberErr as any)?.hint || JSON.stringify(memberErr);\r\n        console.error('Error fetching party members (base rows):', errMsg);\r\n        return { success: false, error: 'Failed to fetch party members' };\r\n      }\r\n\r\n      const members = memberRows || [];\r\n      const userIds = members.map((m: any) => m.user_id).filter(Boolean);\r\n      if (hostId && !userIds.includes(hostId)) {\r\n        userIds.push(hostId);\r\n      }\r\n\r\n      // 2) If there are members, fetch their profiles in a second query\r\n      let profilesById: Record<string, any> = {};\r\n      if (userIds.length > 0) {\r\n        const { data: profiles, error: profileErr } = await this.supabase\r\n    .from('profiles')\r\n    .select('id, full_name, nickname, avatar_url, gender, points, university, show_university, phone_number, show_phone, created_at, updated_at, birth_date')\r\n          .in('id', userIds);\r\n\r\n        if (profileErr) {\r\n          const errMsg = (profileErr as any)?.message || (profileErr as any)?.hint || JSON.stringify(profileErr);\r\n          // If profiles are blocked by RLS, we still return members without profile to avoid hard failure\r\n          console.warn('Profiles fetch blocked or failed; continuing without profile details:', errMsg);\r\n        } else {\r\n          profilesById = (profiles || []).reduce((acc: Record<string, any>, p: any) => {\r\n            acc[p.id] = p;\r\n            return acc;\r\n          }, {});\r\n        }\r\n      }\r\n\r\n      const transformProfile = (profile: any) => {\r\n        if (!profile) return undefined;\r\n        return {\r\n          ...profile,\r\n          created_at: profile.created_at ? new Date(profile.created_at) : null,\r\n          updated_at: profile.updated_at ? new Date(profile.updated_at) : null,\r\n          birth_date: profile.birth_date ? new Date(profile.birth_date) : null,\r\n        };\r\n      };\r\n\r\n      // 3) Transform and attach profiles when available\r\n      const transformedMembers: PartyMember[] = members.map((member: any) => {\r\n        const profile = profilesById[member.user_id];\r\n        return {\r\n          ...member,\r\n          joined_at: new Date(member.joined_at),\r\n          left_at: member.left_at ? new Date(member.left_at) : undefined,\r\n          created_at: new Date(member.created_at),\r\n          updated_at: new Date(member.updated_at),\r\n          profile: transformProfile(profile),\r\n        };\r\n      });\r\n\r\n      if (hostId) {\r\n        const hostAlreadyIncluded = transformedMembers.some((member) => member.user_id === hostId);\r\n        if (!hostAlreadyIncluded) {\r\n          const hostProfile = transformProfile(profilesById[hostId]);\r\n          transformedMembers.unshift({\r\n            id: `host-${partyId}`,\r\n            party_id: partyId,\r\n            user_id: hostId,\r\n            status: 'joined',\r\n            joined_at: partyCreatedAt,\r\n            left_at: undefined,\r\n            pickup_notes: undefined,\r\n            contact_shared: false,\r\n            created_at: partyCreatedAt,\r\n            updated_at: partyCreatedAt,\r\n            profile: hostProfile,\r\n          });\r\n        }\r\n      }\r\n\r\n      return { success: true, members: transformedMembers };\r\n    } catch (error) {\r\n      console.error('Unexpected error fetching party members:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get member count for a party\r\n   */\r\n  async getPartyMemberCount(partyId: string): Promise<{ success: boolean; count?: number; error?: string }> {\r\n    try {\r\n      const { data: count, error } = await this.supabase\r\n  .rpc('get_party_member_count', { p_party_id: partyId });\r\n\r\n      if (error) {\r\n        console.error('Error getting member count:', error);\r\n        return { success: false, error: \"Failed to get member count\" };\r\n      }\r\n\r\n      return { success: true, count: count || 0 };\r\n    } catch (error) {\r\n      console.error('Unexpected error getting member count:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if current user is a member of a party\r\n   */\r\n  async isUserMember(partyId: string): Promise<{ success: boolean; isMember?: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) {\r\n        return { success: true, isMember: false };\r\n      }\r\n\r\n      const { data: membership, error } = await this.supabase\r\n        .from('party_members')\r\n        .select('id')\r\n        .eq('party_id', partyId)\r\n        .eq('user_id', user.id)\r\n        .eq('status', 'joined')\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') { // PGRST116 is \"not found\" error\r\n        console.error('Error checking membership:', error);\r\n        return { success: false, error: \"Failed to check membership\" };\r\n      }\r\n\r\n      return { success: true, isMember: !!membership };\r\n    } catch (error) {\r\n      console.error('Unexpected error checking membership:', error);\r\n      return { success: false, error: \"An unexpected error occurred\" };\r\n    }\r\n  }\r\n\r\n  /** Host-only: kick a member from a party via RPC */\r\n  async kickMember(partyId: string, memberUserId: string): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) return { success: false, error: 'Not authenticated' };\r\n      // Optional: sanity-check host authorization to avoid confusing RLS errors\r\n      const { data: partyRow, error: partyErr } = await this.supabase\r\n        .from('parties')\r\n        .select('host_id')\r\n        .eq('id', partyId)\r\n        .single();\r\n      if (partyErr) {\r\n        // Continue; RLS might block this but RPC may still work\r\n        console.warn('kickMember: failed to verify host_id, continuing to RPC:', (partyErr as any)?.message || partyErr);\r\n      } else if (partyRow && partyRow.host_id !== user.id) {\r\n        return { success: false, error: 'Only the host can kick members' };\r\n      }\r\n\r\n      // First try the generic RPC (may be overloaded in DB)\r\n      const { error } = await this.supabase.rpc('kick_party_member', {\r\n        p_party_id: partyId,\r\n        p_member_user_id: memberUserId,\r\n      });\r\n      if (!error) return { success: true };\r\n\r\n      const errMsg = (error as any)?.message || String(error);\r\n      // Handle ambiguous overload by trying a UUID-specific function if present\r\n      if (errMsg.toLowerCase().includes('choose the best candidate') || errMsg.toLowerCase().includes('ambiguous')) {\r\n        const { error: errUuid } = await this.supabase.rpc('kick_party_member_uuid' as any, {\r\n          p_party_id: partyId,\r\n          p_member_user_id: memberUserId,\r\n        });\r\n        if (!errUuid) return { success: true };\r\n        // Fallback: attempt a direct update if policies allow\r\n        const { error: updErr } = await this.supabase\r\n          .from('party_members')\r\n          .update({ status: 'kicked', left_at: new Date().toISOString() })\r\n          .eq('party_id', partyId)\r\n          .eq('user_id', memberUserId)\r\n          .eq('status', 'joined');\r\n        if (!updErr) return { success: true };\r\n        return { success: false, error: errUuid.message || updErr.message || 'Failed to kick member' };\r\n      }\r\n\r\n      return { success: false, error: errMsg };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Failed to kick member' };\r\n    }\r\n  }\r\n\r\n  /** Fetch pending join requests for parties hosted by the current user */\r\n  async getPendingRequestsForHost(): Promise<{\r\n    success: boolean;\r\n    requests?: Array<{ id: string; party_id: string; user_id: string; created_at: Date; userProfile?: any; party?: any }>;\r\n    error?: string;\r\n  }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) return { success: false, error: 'Not authenticated' };\r\n\r\n      let requests: any[] | null = null;\r\n      let lastError: any = null;\r\n      let partiesMap: Record<string, any> | null = null;\r\n\r\n      const rpcVariants = [\r\n        { p_host_id: user.id },\r\n        { host_id: user.id },\r\n        { p_host_uuid: user.id },\r\n        { host_uuid: user.id },\r\n        { host: user.id },\r\n        { user_id: user.id },\r\n      ];\r\n\r\n      for (const args of rpcVariants) {\r\n        const { data, error } = await this.supabase.rpc('get_pending_requests_for_host', args as any);\r\n        if (!error) {\r\n          requests = data || [];\r\n          lastError = null;\r\n          break;\r\n        }\r\n        lastError = error;\r\n      }\r\n\r\n      if (!requests) {\r\n        const { data, error } = await this.supabase.rpc('get_pending_requests_for_host');\r\n        if (!error) {\r\n          requests = data || [];\r\n          lastError = null;\r\n        } else {\r\n          lastError = error;\r\n        }\r\n      }\r\n\r\n      if (!requests && lastError) {\r\n        const nowIso = new Date().toISOString();\r\n        const { data: hostParties, error: partiesErr } = await this.supabase\r\n          .from('parties')\r\n          .select('id, drop_off, meetup_point, expires_at, is_active')\r\n          .eq('host_id', user.id)\r\n          .eq('is_active', true)\r\n          .gt('expires_at', nowIso);\r\n        if (partiesErr) {\r\n          console.error('getPendingRequestsForHost: fallback parties error:', partiesErr, 'rpc error:', lastError);\r\n          return { success: false, error: 'Failed to fetch requests' };\r\n        }\r\n\r\n        const partyIds = (hostParties || []).map((p: any) => p.id);\r\n        if (partyIds.length === 0) return { success: true, requests: [] };\r\n\r\n        const { data: reqRows, error: reqErr } = await this.supabase\r\n          .from('party_requests')\r\n          .select('request_id, party_id, user_id, created_at, status')\r\n          .in('party_id', partyIds)\r\n          .eq('status', 'pending')\r\n          .order('created_at', { ascending: true });\r\n\r\n        if (reqErr) {\r\n          console.error('getPendingRequestsForHost: fallback requests error:', reqErr, 'rpc error:', lastError);\r\n          return { success: false, error: 'Failed to fetch requests' };\r\n        }\r\n\r\n        requests = reqRows || [];\r\n        partiesMap = (hostParties || []).reduce((acc: Record<string, any>, p: any) => {\r\n          acc[String(p.id)] = p;\r\n          return acc;\r\n        }, {});\r\n      }\r\n\r\n      const requestsList = requests || [];\r\n      if (requestsList.length === 0) return { success: true, requests: [] };\r\n\r\n      // 3) Fetch profiles for requesters\r\n      const userIds = [...new Set(requestsList.map((r: any) => r.user_id))];\r\n      let profilesMap: Record<string, any> = {};\r\n      if (userIds.length > 0) {\r\n        const { data: profs } = await this.supabase\r\n          .from('profiles')\r\n          .select('id, full_name, nickname, avatar_url, gender, university, show_university, points')\r\n          .in('id', userIds);\r\n        (profs || []).forEach((p: any) => { profilesMap[p.id] = p; });\r\n      }\r\n\r\n      const enriched = requestsList.map((r: any) => {\r\n        const fallbackId = `${r.party_id}-${r.user_id}-${r.created_at || r.timestamp || Date.now()}`;\r\n        const partyDetails = partiesMap?.[String(r.party_id)] || r.party || null;\r\n        return {\r\n          id: String(r.id ?? r.request_id ?? fallbackId),\r\n          party_id: String(r.party_id),\r\n          user_id: String(r.user_id),\r\n          created_at: new Date(r.created_at || r.timestamp || Date.now()),\r\n          userProfile: profilesMap[String(r.user_id)],\r\n          party: {\r\n            drop_off: partyDetails?.drop_off ?? r.drop_off ?? null,\r\n            meetup_point: partyDetails?.meetup_point ?? r.meetup_point ?? null,\r\n          },\r\n        };\r\n      });\r\n      return { success: true, requests: enriched };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Failed to load requests' };\r\n    }\r\n  }\r\n\r\n  /** Host-only: approve a pending request */\r\n  async approveRequest(requestId: string, partyId: string, requesterId: string): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) return { success: false, error: 'Not authenticated' };\r\n\r\n      const normalizedRequestId = Number.isFinite(Number(requestId))\r\n        ? Number(requestId)\r\n        : requestId;\r\n\r\n      // Check eligibility via RPC (capacity/duplicate/expiry)\r\n      const { data: canJoin, error: checkError } = await this.supabase\r\n        .rpc('can_user_join_party', { p_party_id: partyId, p_user_id: requesterId });\r\n      if (checkError) {\r\n        console.error('approveRequest: can_user_join_party:', checkError);\r\n        return { success: false, error: 'Failed to verify capacity' };\r\n      }\r\n      if (!canJoin) return { success: false, error: 'Party full/expired or already a member' };\r\n\r\n      // Add as joined member\r\n      const { error: jErr } = await this.supabase\r\n        .from('party_members')\r\n        .insert({ party_id: partyId, user_id: requesterId, status: 'joined', contact_shared: false });\r\n      if (jErr) {\r\n        console.error('approveRequest: insert party_member:', jErr);\r\n        return { success: false, error: 'Failed to add member' };\r\n      }\r\n      // Mark request accepted\r\n      const { error: uErr } = await this.supabase\r\n        .from('party_requests')\r\n        .update({ status: 'accepted' })\r\n        .eq('request_id', normalizedRequestId);\r\n      if (uErr) console.warn('approveRequest: update request failed (non-blocking):', uErr);\r\n      return { success: true };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Approve failed' };\r\n    }\r\n  }\r\n\r\n  /** Host-only: decline a pending request */\r\n  async declineRequest(requestId: string): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const normalizedRequestId = Number.isFinite(Number(requestId))\r\n        ? Number(requestId)\r\n        : requestId;\r\n      const { error } = await this.supabase\r\n        .from('party_requests')\r\n        .update({ status: 'declined' })\r\n        .eq('request_id', normalizedRequestId);\r\n      if (error) return { success: false, error: error.message };\r\n      return { success: true };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Decline failed' };\r\n    }\r\n  }\r\n}\r\n\r\n// Export a singleton instance\r\nexport const partyMemberService = new PartyMemberService();\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1874, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/lib/party.ts"],"sourcesContent":["import type { Party, PartyMember } from \"@/app/(main)/dashboard/types\";\r\n\r\nconst getJoinedMembers = (members?: PartyMember[]): PartyMember[] => {\r\n    if (!Array.isArray(members)) {\r\n        return [];\r\n    }\r\n    return members.filter((member) => member.status === \"joined\");\r\n};\r\n\r\nconst hostIncluded = (hostId: string, members: PartyMember[]): boolean => {\r\n    return members.some((member) => member.user_id === hostId);\r\n};\r\n\r\nexport const getPartyOccupancy = (party: Party, membersOverride?: PartyMember[]): number => {\r\n    const effectiveMembers = getJoinedMembers(membersOverride ?? party.members);\r\n    if (effectiveMembers.length > 0) {\r\n        return hostIncluded(party.host_id, effectiveMembers)\r\n            ? effectiveMembers.length\r\n            : effectiveMembers.length + 1;\r\n    }\r\n    const count = typeof party.current_member_count === \"number\" ? party.current_member_count : 0;\r\n    return Math.max(count, 0) + 1;\r\n};\r\n\r\nexport const getRemainingSlots = (party: Party, membersOverride?: PartyMember[]): number => {\r\n    const occupancy = getPartyOccupancy(party, membersOverride);\r\n    return Math.max(0, party.party_size - occupancy);\r\n};\r\n"],"names":[],"mappings":";;;;AAEA,MAAM,mBAAmB,CAAC;IACtB,IAAI,CAAC,MAAM,OAAO,CAAC,UAAU;QACzB,OAAO,EAAE;IACb;IACA,OAAO,QAAQ,MAAM,CAAC,CAAC,SAAW,OAAO,MAAM,KAAK;AACxD;AAEA,MAAM,eAAe,CAAC,QAAgB;IAClC,OAAO,QAAQ,IAAI,CAAC,CAAC,SAAW,OAAO,OAAO,KAAK;AACvD;AAEO,MAAM,oBAAoB,CAAC,OAAc;IAC5C,MAAM,mBAAmB,iBAAiB,mBAAmB,MAAM,OAAO;IAC1E,IAAI,iBAAiB,MAAM,GAAG,GAAG;QAC7B,OAAO,aAAa,MAAM,OAAO,EAAE,oBAC7B,iBAAiB,MAAM,GACvB,iBAAiB,MAAM,GAAG;IACpC;IACA,MAAM,QAAQ,OAAO,MAAM,oBAAoB,KAAK,WAAW,MAAM,oBAAoB,GAAG;IAC5F,OAAO,KAAK,GAAG,CAAC,OAAO,KAAK;AAChC;AAEO,MAAM,oBAAoB,CAAC,OAAc;IAC5C,MAAM,YAAY,kBAAkB,OAAO;IAC3C,OAAO,KAAK,GAAG,CAAC,GAAG,MAAM,UAAU,GAAG;AAC1C","debugId":null}},
    {"offset": {"line": 1903, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/components/ui/dialog.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\r\nimport { XIcon } from \"lucide-react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nfunction Dialog({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Root>) {\r\n  return <DialogPrimitive.Root data-slot=\"dialog\" {...props} />\r\n}\r\n\r\nfunction DialogTrigger({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {\r\n  return <DialogPrimitive.Trigger data-slot=\"dialog-trigger\" {...props} />\r\n}\r\n\r\nfunction DialogPortal({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Portal>) {\r\n  return <DialogPrimitive.Portal data-slot=\"dialog-portal\" {...props} />\r\n}\r\n\r\nfunction DialogClose({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Close>) {\r\n  return <DialogPrimitive.Close data-slot=\"dialog-close\" {...props} />\r\n}\r\n\r\nfunction DialogOverlay({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {\r\n  return (\r\n    <DialogPrimitive.Overlay\r\n      data-slot=\"dialog-overlay\"\r\n      className={cn(\r\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DialogContent({\r\n  className,\r\n  children,\r\n  showCloseButton = true,\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Content> & {\r\n  showCloseButton?: boolean\r\n}) {\r\n  return (\r\n    <DialogPortal data-slot=\"dialog-portal\">\r\n      <DialogOverlay />\r\n      <DialogPrimitive.Content\r\n        data-slot=\"dialog-content\"\r\n        className={cn(\r\n          \"bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg\",\r\n          className\r\n        )}\r\n        {...props}\r\n      >\r\n        {children}\r\n        {showCloseButton && (\r\n          <DialogPrimitive.Close\r\n            data-slot=\"dialog-close\"\r\n            className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\"\r\n          >\r\n            <XIcon />\r\n            <span className=\"sr-only\">Close</span>\r\n          </DialogPrimitive.Close>\r\n        )}\r\n      </DialogPrimitive.Content>\r\n    </DialogPortal>\r\n  )\r\n}\r\n\r\nfunction DialogHeader({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"dialog-header\"\r\n      className={cn(\"flex flex-col gap-2 text-center sm:text-left\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DialogFooter({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"dialog-footer\"\r\n      className={cn(\r\n        \"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DialogTitle({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Title>) {\r\n  return (\r\n    <DialogPrimitive.Title\r\n      data-slot=\"dialog-title\"\r\n      className={cn(\"text-lg leading-none font-semibold\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction DialogDescription({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPrimitive.Description>) {\r\n  return (\r\n    <DialogPrimitive.Description\r\n      data-slot=\"dialog-description\"\r\n      className={cn(\"text-muted-foreground text-sm\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport {\r\n  Dialog,\r\n  DialogClose,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogOverlay,\r\n  DialogPortal,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;AAGA;AACA;AAEA;AANA;;;;;AAQA,SAAS,OAAO,EACd,GAAG,OAC+C;IAClD,qBAAO,8OAAC,kKAAA,CAAA,OAAoB;QAAC,aAAU;QAAU,GAAG,KAAK;;;;;;AAC3D;AAEA,SAAS,cAAc,EACrB,GAAG,OACkD;IACrD,qBAAO,8OAAC,kKAAA,CAAA,UAAuB;QAAC,aAAU;QAAkB,GAAG,KAAK;;;;;;AACtE;AAEA,SAAS,aAAa,EACpB,GAAG,OACiD;IACpD,qBAAO,8OAAC,kKAAA,CAAA,SAAsB;QAAC,aAAU;QAAiB,GAAG,KAAK;;;;;;AACpE;AAEA,SAAS,YAAY,EACnB,GAAG,OACgD;IACnD,qBAAO,8OAAC,kKAAA,CAAA,QAAqB;QAAC,aAAU;QAAgB,GAAG,KAAK;;;;;;AAClE;AAEA,SAAS,cAAc,EACrB,SAAS,EACT,GAAG,OACkD;IACrD,qBACE,8OAAC,kKAAA,CAAA,UAAuB;QACtB,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,0JACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,cAAc,EACrB,SAAS,EACT,QAAQ,EACR,kBAAkB,IAAI,EACtB,GAAG,OAGJ;IACC,qBACE,8OAAC;QAAa,aAAU;;0BACtB,8OAAC;;;;;0BACD,8OAAC,kKAAA,CAAA,UAAuB;gBACtB,aAAU;gBACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,+WACA;gBAED,GAAG,KAAK;;oBAER;oBACA,iCACC,8OAAC,kKAAA,CAAA,QAAqB;wBACpB,aAAU;wBACV,WAAU;;0CAEV,8OAAC,gMAAA,CAAA,QAAK;;;;;0CACN,8OAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;;;;;;;;;;;;;AAMtC;AAEA,SAAS,aAAa,EAAE,SAAS,EAAE,GAAG,OAAoC;IACxE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,gDAAgD;QAC7D,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,aAAa,EAAE,SAAS,EAAE,GAAG,OAAoC;IACxE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,0DACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,8OAAC,kKAAA,CAAA,QAAqB;QACpB,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,sCAAsC;QACnD,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,kBAAkB,EACzB,SAAS,EACT,GAAG,OACsD;IACzD,qBACE,8OAAC,kKAAA,CAAA,cAA2B;QAC1B,aAAU;QACV,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf","debugId":null}},
    {"offset": {"line": 2075, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/PartyMembersDialog.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\r\nimport { Users, Crown } from 'lucide-react';\r\nimport { Party, PartyMember } from \"../types\";\r\nimport { toast } from \"sonner\";\r\nimport { partyMemberService } from \"../services/partyMemberService\";\r\nimport useAuthStore from \"@/stores/authStore\";\r\nimport Image from \"next/image\";\r\nimport { getPartyOccupancy } from \"@/lib/party\";\r\n\r\ninterface PartyMembersDialogProps {\r\n  party: Party;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport default function PartyMembersDialog({ party, children }: PartyMembersDialogProps) {\r\n  const [members, setMembers] = useState<PartyMember[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const { user } = useAuthStore();\r\n  const isHost = user?.id === party.host_id;\r\n  const visibleMembers = useMemo(\r\n    () => members.filter((member) => member.user_id !== party.host_id),\r\n    [members, party.host_id]\r\n  );\r\n\r\n  const fetchMembers = useCallback(async () => {\r\n    if (!isOpen) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      // Only host or joined members should fetch the list to respect RLS\r\n      if (!isHost && !party.user_is_member) {\r\n        setMembers([]);\r\n        return;\r\n      }\r\n      const result = await partyMemberService.getPartyMembers(party.id);\r\n      if (result.success && result.members) {\r\n        setMembers(result.members);\r\n      } else if (!result.success) {\r\n        toast.error(result.error || 'Failed to fetch party members');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching party members:', error);\r\n      toast.error('Failed to fetch party members');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [isHost, isOpen, party.id, party.user_is_member]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      fetchMembers();\r\n    }\r\n  }, [fetchMembers, isOpen]);\r\n\r\n  const getDisplayName = (member: PartyMember) => {\r\n    const profile = member.profile;\r\n    if (!profile) return 'Anonymous Member';\r\n    return profile.nickname || profile.full_name || 'Anonymous Member';\r\n  };\r\n\r\n  const getInitials = (member: PartyMember) => {\r\n    const profile = member.profile;\r\n    if (!profile) return 'M';\r\n    \r\n    const name = profile.nickname || profile.full_name;\r\n    if (!name) return 'M';\r\n    \r\n    return name\r\n      .split(' ')\r\n      .map(word => word.charAt(0).toUpperCase())\r\n      .slice(0, 2)\r\n      .join('');\r\n  };\r\n\r\n  const formatJoinTime = (joinedAt: Date) => {\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - joinedAt.getTime();\r\n    const diffMins = Math.floor(diffMs / (1000 * 60));\r\n    \r\n    if (diffMins < 1) return 'Just joined';\r\n    if (diffMins < 60) return `${diffMins}m ago`;\r\n    \r\n    const diffHours = Math.floor(diffMins / 60);\r\n    if (diffHours < 24) return `${diffHours}h ago`;\r\n    \r\n    const diffDays = Math.floor(diffHours / 24);\r\n    return `${diffDays}d ago`;\r\n  };\r\n\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n      <DialogTrigger asChild>\r\n        {children}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Users className=\"w-5 h-5\" />\r\n            Party Members ({getPartyOccupancy(party, members)}/{party.party_size})\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"space-y-3 max-h-96 overflow-y-auto\">\r\n          {/* Host */}\r\n          <div className=\"flex items-center gap-3 p-3 bg-primary/5 rounded-lg\">\r\n            <Avatar className=\"w-10 h-10\">\r\n              {party.host_profile?.avatar_url ? (\r\n                <Image\r\n                  src={party.host_profile.avatar_url} \r\n                  alt=\"Host avatar\" \r\n                  width={40}\r\n                  height={40}\r\n                  className=\"w-full h-full object-cover rounded-full\"\r\n                />\r\n              ) : (\r\n                <AvatarFallback className=\"bg-primary/20 text-primary font-semibold\">\r\n                  {party.host_profile?.nickname?.charAt(0).toUpperCase() || \r\n                   party.host_profile?.full_name?.charAt(0).toUpperCase() || 'H'}\r\n                </AvatarFallback>\r\n              )}\r\n            </Avatar>\r\n            <div className=\"flex-1 min-w-0\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <p className=\"font-semibold text-sm truncate\">\r\n                  {party.host_profile?.nickname || \r\n                   party.host_profile?.full_name || \r\n                   'Anonymous Host'}\r\n                </p>\r\n                <Crown className=\"w-4 h-4 text-primary\" />\r\n              </div>\r\n              <p className=\"text-xs text-muted-foreground\">Host</p>\r\n            </div>\r\n            {party.host_profile?.points !== null && party.host_profile?.points !== undefined && (\r\n              <div className=\"text-xs text-primary font-medium\">\r\n                {party.host_profile.points} pts\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Members */}\r\n          {isLoading ? (\r\n            <div className=\"space-y-2\">\r\n              {[...Array(2)].map((_, i) => (\r\n                <div key={i} className=\"flex items-center gap-3 p-3 animate-pulse\">\r\n                  <div className=\"w-10 h-10 bg-muted rounded-full\"></div>\r\n                  <div className=\"flex-1 space-y-1\">\r\n                    <div className=\"h-4 bg-muted rounded w-24\"></div>\r\n                    <div className=\"h-3 bg-muted rounded w-16\"></div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (!isHost && !party.user_is_member) ? (\r\n            <div className=\"text-center py-6 text-muted-foreground\">\r\n              <Users className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\r\n              <p className=\"text-sm\">Join this party to see the member list</p>\r\n            </div>\r\n          ) : visibleMembers.length === 0 ? (\r\n            <div className=\"text-center py-6 text-muted-foreground\">\r\n              <Users className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\r\n              <p className=\"text-sm\">No other members yet</p>\r\n            </div>\r\n          ) : (\r\n            visibleMembers.map((member) => (\r\n              <div key={member.id} className=\"flex items-center gap-3 p-3 hover:bg-muted/50 rounded-lg transition-colors\">\r\n                <Avatar className=\"w-10 h-10\">\r\n                  {member.profile?.avatar_url ? (\r\n                    <Image\r\n                      src={member.profile.avatar_url} \r\n                      alt=\"Member avatar\" \r\n                      width={40}\r\n                      height={40}\r\n                      className=\"w-full h-full object-cover rounded-full\"\r\n                    />\r\n                  ) : (\r\n                    <AvatarFallback className=\"bg-secondary/20 text-secondary-foreground font-semibold\">\r\n                      {getInitials(member)}\r\n                    </AvatarFallback>\r\n                  )}\r\n                </Avatar>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <p className=\"font-medium text-sm truncate\">\r\n                    {getDisplayName(member)}\r\n                  </p>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    Joined {formatJoinTime(member.joined_at)}\r\n                  </p>\r\n                </div>\r\n                {member.profile?.points !== null && member.profile?.points !== undefined && (\r\n                  <div className=\"text-xs text-primary font-medium\">\r\n                    {member.profile.points} pts\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2488, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/DashboardPartyCard.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Party } from \"../types\";\r\nimport { Clock, Users, MapPin, User as UserIcon, Bell, BellOff, Share2, Star, Pencil } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\r\nimport useAuthStore from \"@/stores/authStore\";\r\nimport useDashboardDataStore from \"@/stores/dashboardDataStore\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport { partyMemberService } from \"../services/partyMemberService\";\r\nimport { getPartyOccupancy } from \"@/lib/party\";\r\nimport PartyMembersDialog from \"./PartyMembersDialog\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Image from \"next/image\";\r\n\r\nimport dynamic from \"next/dynamic\";\r\n// Dynamically import RideMap to avoid SSR issues\r\nconst RideMap = dynamic(() => import(\"@/components/RideMap\"), { ssr: false });\r\n\r\ninterface DashboardPartyCardProps {\r\n    party: Party;\r\n}\r\n\r\nconst EXPIRY_OPTIONS = [\r\n    { label: \"10 min\", minutes: 10 },\r\n    { label: \"15 min\", minutes: 15 },\r\n    { label: \"20 min\", minutes: 20 },\r\n    { label: \"30 min\", minutes: 30 },\r\n    { label: \"1 hr\", minutes: 60 },\r\n];\r\n\r\n// Helper function to format remaining time as MM:SS\r\nconst formatTimeLeft = (ms: number): string => {\r\n    const totalSeconds = Math.max(0, Math.floor(ms / 1000));\r\n    const minutes = Math.floor(totalSeconds / 60);\r\n    const seconds = totalSeconds % 60;\r\n    return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;\r\n}\r\n\r\nexport default function DashboardPartyCard({ party }: DashboardPartyCardProps) {\r\n    const refreshParties = useDashboardDataStore((state) => state.refreshParties);\r\n    const supabaseClient = useMemo(() => createClient(), []);\r\n    const [editingExpiry, setEditingExpiry] = useState(false);\r\n    const [newExpiryMinutes, setNewExpiryMinutes] = useState<number | null>(null);\r\n    const [updatingExpiry, setUpdatingExpiry] = useState(false);\r\n    const [showProfileDialog, setShowProfileDialog] = useState(false);\r\n    const [showMapDialog, setShowMapDialog] = useState(false);\r\n\r\n    // Update expiry handler\r\n    const handleUpdateExpiry = async () => {\r\n        if (!newExpiryMinutes || !user) return;\r\n        setUpdatingExpiry(true);\r\n        try {\r\n            const newExpiryTimestamp = new Date(Date.now() + newExpiryMinutes * 60_000).toISOString();\r\n            const { error } = await supabaseClient\r\n                .from('parties')\r\n                .update({\r\n                    duration_minutes: newExpiryMinutes,\r\n                    expires_at: newExpiryTimestamp\r\n                })\r\n                .eq('id', party.id)\r\n                .eq('host_id', user.id);\r\n            if (error) {\r\n                toast.error('Failed to update expiry');\r\n            } else {\r\n                toast.success('Expiry updated!');\r\n                setEditingExpiry(false);\r\n                setNewExpiryMinutes(null);\r\n                await refreshParties();\r\n            }\r\n        } catch (e) {\r\n            toast.error('Unexpected error updating expiry');\r\n        } finally {\r\n            setUpdatingExpiry(false);\r\n        }\r\n    };\r\n    // Helper to get the base URL (works for both dev and prod)\r\n    const getBaseUrl = () => {\r\n        if (typeof window !== 'undefined') {\r\n            return window.location.origin;\r\n        }\r\n        return '';\r\n    };\r\n\r\n    // Share handler\r\n    const handleShareParty = async () => {\r\n        const shareUrl = `${getBaseUrl()}/party/${party.id}`;\r\n        const shareText = `Join my party on Meet Riders!\\n${shareUrl}`;\r\n        if (navigator.share) {\r\n            try {\r\n                await navigator.share({\r\n                    title: 'Join my party on Meet Riders!',\r\n                    text: 'Check out this party I created. Click to join!',\r\n                    url: shareUrl,\r\n                });\r\n            } catch (err) {\r\n                // User cancelled or error\r\n            }\r\n        } else if (navigator.clipboard) {\r\n            try {\r\n                await navigator.clipboard.writeText(shareUrl);\r\n                toast.success('Party link copied to clipboard!');\r\n            } catch (err) {\r\n                toast.error('Failed to copy link.');\r\n            }\r\n        } else {\r\n            // fallback: prompt\r\n            window.prompt('Copy this link:', shareUrl);\r\n        }\r\n    };\r\n    const { user } = useAuthStore();\r\n    const isHost = party.host_id === user?.id;\r\n    const [timeLeft, setTimeLeft] = useState(party.expires_at.getTime() - Date.now());\r\n    const [alertOn, setAlertOn] = useState<boolean>(false);\r\n    const [isJoining, setIsJoining] = useState(false);\r\n    const [isLeaving, setIsLeaving] = useState(false);\r\n    // Overlay removed; redirect instead\r\n    const router = useRouter();\r\n\r\n    useEffect(() => {\r\n        const timer = setInterval(() => {\r\n            setTimeLeft(party.expires_at.getTime() - Date.now());\r\n        }, 1000);\r\n\r\n        return () => clearInterval(timer);\r\n    }, [party.expires_at]);\r\n\r\n    const isExpired = timeLeft <= 0 || !party.is_active;\r\n\r\n    const handleJoinParty = async () => {\r\n        if (!user || isHost || party.user_is_member) return;\r\n\r\n        setIsJoining(true);\r\n        try {\r\n            // Always request-based join flow: create a pending request and do not join yet\r\n            // Avoid duplicate pending requests\r\n            const { data: existing } = await supabaseClient\r\n              .from('party_requests')\r\n              .select('id, status')\r\n              .eq('party_id', party.id)\r\n              .eq('user_id', user.id)\r\n              .order('created_at', { ascending: false })\r\n              .limit(1);\r\n            if (existing && existing.length && existing[0].status === 'pending') {\r\n                toast.info('Join request already pending');\r\n                return;\r\n            }\r\n            const { error } = await supabaseClient\r\n                .rpc('create_join_request', { p_party_id: party.id });\r\n            if (error) {\r\n                const anyErr: any = error as any;\r\n                const code = anyErr?.code || anyErr?.details || '';\r\n                if (code?.toString?.().includes('23505') || (anyErr?.message || '').toLowerCase().includes('duplicate')) {\r\n                    toast.info('Join request already pending');\r\n                    return;\r\n                }\r\n                const errMsg = anyErr?.message || anyErr?.hint || anyErr?.details || 'Unknown error';\r\n                console.error('Error creating party request:', errMsg, anyErr);\r\n                toast.error('Failed to send join request');\r\n            } else {\r\n                toast.success('Request sent to host');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error joining party:', error);\r\n            toast.error('Unexpected error while joining the party');\r\n        } finally {\r\n            setIsJoining(false);\r\n        }\r\n    };\r\n\r\n    const handleLeaveParty = async () => {\r\n        if (!user || !party.user_is_member) return;\r\n        \r\n        const confirmed = confirm('Are you sure you want to leave this party?');\r\n        if (!confirmed) return;\r\n\r\n        setIsLeaving(true);\r\n        try {\r\n            const result = await partyMemberService.leaveParty(party.id);\r\n            \r\n            if (result.success) {\r\n                toast.success('Left the party');\r\n                // Trigger refresh of parties data\r\n                await refreshParties();\r\n            } else {\r\n                toast.error(result.error || 'Failed to leave party');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error leaving party:', error);\r\n            toast.error('Unexpected error while leaving the party');\r\n        } finally {\r\n            setIsLeaving(false);\r\n        }\r\n    };\r\n\r\n    const handleCancelParty = async () => {\r\n        if (!user || !isHost) return;\r\n\r\n        const confirmed = confirm('Are you sure you want to cancel this party?');\r\n        if (!confirmed) return;\r\n\r\n        try {\r\n            const { error } = await supabaseClient\r\n                .from('parties')\r\n                .update({ is_active: false })\r\n                .eq('id', party.id)\r\n                .eq('host_id', user.id);\r\n\r\n            if (error) {\r\n                console.error('Error canceling party:', error);\r\n                toast.error('Failed to cancel party');\r\n            } else {\r\n                toast.success('Party canceled');\r\n                await refreshParties();\r\n            }\r\n        } catch (error) {\r\n            console.error('Error canceling party:', error);\r\n            toast.error('Failed to cancel party');\r\n        }\r\n    };\r\n\r\n    const getRideOptionsDisplay = () => {\r\n        if (!party.ride_options || party.ride_options.length === 0) {\r\n            return 'Any ride';\r\n        }\r\n        return party.ride_options.join(', ');\r\n    };\r\n\r\n    const getHostDisplayName = () => {\r\n        if (isHost) {\r\n            return 'Your Party';\r\n        }\r\n        \r\n        const profile = party.host_profile;\r\n        if (!profile) {\r\n            return 'Anonymous Host';\r\n        }\r\n        \r\n        return profile.nickname || profile.full_name || 'Anonymous Host';\r\n    };\r\n\r\n    const getHostInitials = () => {\r\n        if (isHost) {\r\n            return 'ME';\r\n        }\r\n        \r\n        const profile = party.host_profile;\r\n        if (!profile) {\r\n            return 'H';\r\n        }\r\n        \r\n        const name = profile.nickname || profile.full_name;\r\n        if (!name) {\r\n            return 'H';\r\n        }\r\n        \r\n        return name\r\n            .split(' ')\r\n            .map(word => word.charAt(0).toUpperCase())\r\n            .slice(0, 2)\r\n            .join('');\r\n    };\r\n\r\n    return (\r\n        <div className=\"transition-all rounded-lg duration-300 hover:shadow-lg relative overflow-hidden bg-card/60 backdrop-blur-[6.2px]\" \r\n              style={{\r\n                  boxShadow: '0 4px 30px rgba(0, 0, 0, 0.1)',\r\n                  border: '1px solid rgba(255, 255, 255, 0.1)'\r\n              }}>\r\n                <CardHeader className='hidden'></CardHeader>\r\n            <div className=\"p-3\">\r\n                {/* Host Profile Popup Dialog */}\r\n                {showProfileDialog && party.host_profile && (\r\n                    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40\">\r\n                        <div className=\"bg-card rounded-lg shadow-lg p-6 max-w-md w-full relative\">\r\n                            <button className=\"absolute top-2 right-2 text-xl\" onClick={() => setShowProfileDialog(false)}>&times;</button>\r\n                            <div className=\"flex flex-col items-center gap-2\">\r\n                                <Avatar className=\"w-20 h-20\">\r\n                                    {party.host_profile.avatar_url ? (\r\n                                        <Image src={party.host_profile.avatar_url} alt=\"Host avatar\" width={80} height={80} className=\"w-full h-full object-cover rounded-full\" />\r\n                                    ) : (\r\n                                        <AvatarFallback className=\"bg-primary/10 text-primary font-semibold text-2xl\">\r\n                                            {getHostInitials()}\r\n                                        </AvatarFallback>\r\n                                    )}\r\n                                </Avatar>\r\n                                <h2 className=\"text-xl font-bold mt-2\">{party.host_profile.nickname || party.host_profile.full_name || 'Anonymous Host'}</h2>\r\n                                {party.host_profile.university && (\r\n                                    <div className=\"text-sm text-muted-foreground\">{party.host_profile.university}</div>\r\n                                )}\r\n                                {party.host_profile.gender && (\r\n                                    <div className=\"text-sm text-muted-foreground\">Gender: {party.host_profile.gender}</div>\r\n                                )}\r\n                                {party.host_profile.points !== null && party.host_profile.points !== undefined && (\r\n                                    <div className=\"text-sm text-muted-foreground\">Points: {party.host_profile.points}</div>\r\n                                )}\r\n                                {party.host_profile.bio && (\r\n                                    <div className=\"text-sm text-muted-foreground mt-2 text-center\">{party.host_profile.bio}</div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Map View Dialog for members */}\r\n                <Dialog open={showMapDialog} onOpenChange={setShowMapDialog}>\r\n                    <DialogContent className=\"max-w-4xl\">\r\n                        <DialogTitle>Party Map</DialogTitle>\r\n                        {party.start_coords && party.dest_coords ? (\r\n                            <div className=\"mt-2\">\r\n                                <RideMap start={party.start_coords} dest={party.dest_coords} height={480} isReadOnly={true} />\r\n                            </div>\r\n                        ) : (\r\n                            <p className=\"text-sm text-muted-foreground\">No map data available for this party.</p>\r\n                        )}\r\n                    </DialogContent>\r\n                </Dialog>\r\n\r\n                {/* Main Grid Layout: Left Column (Host Info) + Right Column (Party Details) */}\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-[120px_1fr] gap-3\">\r\n                    {/* Left Column: Host Info */}\r\n                    <div className=\"flex lg:flex-col items-center lg:items-center gap-2 lg:gap-1.5\">\r\n                        <button onClick={() => setShowProfileDialog(true)} className=\"focus:outline-none flex-shrink-0\">\r\n                            <Avatar className=\"w-12 h-12 lg:w-14 lg:h-14\">\r\n                                {party.host_profile?.avatar_url ? (\r\n                                    <Image\r\n                                        src={party.host_profile.avatar_url} \r\n                                        alt=\"Host avatar\" \r\n                                        width={56}\r\n                                        height={56}\r\n                                        className=\"w-full h-full object-cover rounded-full\"\r\n                                    />\r\n                                ) : (\r\n                                    <AvatarFallback className=\"bg-primary/10 text-primary font-semibold text-sm\">\r\n                                        {getHostInitials()}\r\n                                    </AvatarFallback>\r\n                                )}\r\n                            </Avatar>\r\n                        </button>\r\n                        \r\n                        <div className=\"flex-1 lg:flex-none lg:w-full text-left lg:text-center space-y-0.5\">\r\n                            <div className=\"flex lg:flex-col items-center lg:items-center gap-1.5 lg:gap-0.5\">\r\n                                <h3 className=\"font-bold text-sm truncate max-w-full\">\r\n                                    {getHostDisplayName()}\r\n                                </h3>\r\n                                {isExpired && (\r\n                                    <span className=\"bg-destructive/10 text-destructive px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap\">\r\n                                        EXPIRED\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"text-[11px] text-muted-foreground space-y-0\">\r\n                                {party.host_profile?.gender && (\r\n                                    <div className=\"capitalize\">{party.host_profile.gender}</div>\r\n                                )}\r\n                                {party.host_profile?.points !== null && party.host_profile?.points !== undefined && (\r\n                                    <div className=\"text-primary font-medium\">\r\n                                        {party.host_profile.points} pts\r\n                                    </div>\r\n                                )}\r\n                                {party.host_profile?.university && party.display_university && (\r\n                                    <div className=\"flex items-center gap-1 lg:justify-center\">\r\n                                        <Star className=\"w-3 h-3 flex-shrink-0\" />\r\n                                        <span className=\"text-xs truncate\">{party.host_profile.university}</span>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Right Column: Party Details */}\r\n                    <div className=\"space-y-2.5 min-w-0\">\r\n                        {/* Timer and Route in one row for desktop */}\r\n                        <div className=\"flex flex-col sm:flex-row gap-2\">\r\n                            {/* Route Info */}\r\n                            <div className=\"flex-1 min-w-0 bg-muted/30 rounded-lg p-2\">\r\n                                <div className=\"flex items-start gap-1.5\">\r\n                                    <MapPin className=\"w-3.5 h-3.5 text-primary flex-shrink-0 mt-0.5\" />\r\n                                    <div className=\"flex-1 min-w-0 text-xs space-y-0.5\">\r\n                                        <div className=\"flex items-baseline gap-1.5\">\r\n                                            <span className=\"text-[11px] text-muted-foreground font-medium flex-shrink-0\">From:</span>\r\n                                            <span className=\"truncate flex-1\">{party.meetup_point}</span>\r\n                                        </div>\r\n                                        <div className=\"flex items-baseline gap-1.5\">\r\n                                            <span className=\"text-[11px] text-muted-foreground font-medium flex-shrink-0\">To:</span>\r\n                                            <span className=\"truncate font-semibold flex-1\">{party.drop_off}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            \r\n                            {/* Timer */}\r\n                            <div className=\"flex sm:flex-col items-center sm:items-end justify-between sm:justify-center gap-1 sm:w-[90px] flex-shrink-0\">\r\n                                <div className=\"flex items-center gap-0.5\">\r\n                                    <div className=\"text-lg sm:text-xl font-bold text-primary tabular-nums\">\r\n                                        {isExpired ? '--:--' : formatTimeLeft(timeLeft)}\r\n                                    </div>\r\n                                    {isHost && !isExpired && (\r\n                                        <button\r\n                                            className=\"p-0.5 rounded hover:bg-accent/40 transition-colors\"\r\n                                            title=\"Edit expiry time\"\r\n                                            onClick={() => setEditingExpiry((v) => !v)}\r\n                                        >\r\n                                            <Pencil className=\"w-3 h-3 text-muted-foreground\" />\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                                <div className=\"text-[10px] text-muted-foreground whitespace-nowrap\">\r\n                                    {isExpired ? 'Ended' : 'Remaining'}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        \r\n                        {/* Expiry Editor */}\r\n                        {isHost && !isExpired && editingExpiry && (\r\n                            <div className=\"flex flex-wrap items-center gap-2 p-2 bg-muted/50 rounded-lg\">\r\n                                <select\r\n                                    className=\"border rounded px-3 py-1.5 text-sm\"\r\n                                    value={newExpiryMinutes ?? \"\"}\r\n                                    onChange={e => setNewExpiryMinutes(e.target.value ? Number(e.target.value) : null)}\r\n                                >\r\n                                    <option value=\"\">Select new expiry</option>\r\n                                    {EXPIRY_OPTIONS.map(opt => (\r\n                                        <option key={opt.minutes} value={opt.minutes}>{opt.label}</option>\r\n                                    ))}\r\n                                </select>\r\n                                <Button size=\"sm\" disabled={updatingExpiry || !newExpiryMinutes} onClick={handleUpdateExpiry}>\r\n                                    {updatingExpiry ? 'Updating...' : 'Save'}\r\n                                </Button>\r\n                                <Button size=\"sm\" variant=\"ghost\" onClick={() => setEditingExpiry(false)}>Cancel</Button>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Map (conditionally shown) */}\r\n                        {party.start_coords && party.dest_coords && (\r\n                            <div className=\"rounded-lg overflow-hidden\">\r\n                                <RideMap start={party.start_coords} dest={party.dest_coords} height={140} />\r\n                            </div>\r\n                        )}\r\n                        \r\n                        {/* Host Comments */}\r\n                        {party.user_is_member && party.host_comments && (\r\n                            <div className=\"p-2 bg-accent/40 rounded-lg border border-accent\">\r\n                                <p className=\"font-semibold text-[11px] mb-0.5\">Host Comments</p>\r\n                                <p className=\"text-xs whitespace-pre-line\">{party.host_comments}</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Bottom Row: Details + Actions */}\r\n                        <div className=\"flex flex-wrap items-center justify-between gap-2 pt-1.5 border-t\">\r\n                            <div className=\"flex items-center gap-3 text-xs\">\r\n                                <PartyMembersDialog party={party}>\r\n                                    <button className=\"flex items-center gap-1 hover:text-primary transition-colors\">\r\n                                        <Users className=\"w-3.5 h-3.5 text-muted-foreground\" />\r\n                                        <span className=\"font-medium\">\r\n                                            {getPartyOccupancy(party)}/{party.party_size}\r\n                                        </span>\r\n                                    </button>\r\n                                </PartyMembersDialog>\r\n                                \r\n                                <div className=\"flex items-center gap-1\">\r\n                                    <Clock className=\"w-3.5 h-3.5 text-muted-foreground\" />\r\n                                    <span className=\"text-[11px]\">{getRideOptionsDisplay()}</span>\r\n                                </div>\r\n                                \r\n                                {party.is_friends_only && (\r\n                                    <div className=\"bg-accent/70 px-1.5 py-0.5 rounded text-[10px] font-medium\">\r\n                                         Connections\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Action Buttons */}\r\n                            <div className=\"flex gap-1.5\">\r\n                                {isHost ? (\r\n                                    <>\r\n                                        <Button \r\n                                            variant=\"destructive\" \r\n                                            size=\"sm\"\r\n                                            onClick={handleCancelParty}\r\n                                            className=\"h-8 text-xs\"\r\n                                        >\r\n                                            Cancel Party\r\n                                        </Button>\r\n                                        <Button variant=\"outline\" size=\"sm\" className=\"h-8 px-2\" onClick={handleShareParty}>\r\n                                            <Share2 className=\"w-3.5 h-3.5\" />\r\n                                        </Button>\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        {party.user_is_member ? (\r\n                                            <>\r\n                                                <Button\r\n                                                    size=\"sm\"\r\n                                                    onClick={() => setShowMapDialog(true)}\r\n                                                    className=\"h-8 text-xs mr-2\"\r\n                                                    variant=\"outline\"\r\n                                                >\r\n                                                    View Map\r\n                                                </Button>\r\n\r\n                                                <Button \r\n                                                    variant=\"outline\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={handleLeaveParty}\r\n                                                    disabled={isLeaving}\r\n                                                    className=\"h-8 text-xs\"\r\n                                                >\r\n                                                    {isLeaving ? 'Leaving...' : 'Leave Party'}\r\n                                                </Button>\r\n                                            </>\r\n                                        ) : (\r\n                                            <Button \r\n                                                size=\"sm\"\r\n                                                onClick={handleJoinParty}\r\n                                                disabled={isExpired || isJoining || getPartyOccupancy(party) >= party.party_size}\r\n                                                className=\"h-8 text-xs\"\r\n                                                variant={isExpired || getPartyOccupancy(party) >= party.party_size ? \"outline\" : \"default\"}\r\n                                            >\r\n                                                {isJoining \r\n                                                    ? 'Joining...' \r\n                                                    : isExpired \r\n                                                    ? 'Expired' \r\n                                                    : getPartyOccupancy(party) >= party.party_size \r\n                                                    ? 'Full' \r\n                                                    : 'Join Party'\r\n                                                }\r\n                                            </Button>\r\n                                        )}\r\n                                        <Button \r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => setAlertOn(!alertOn)}\r\n                                            className=\"h-8 px-2\"\r\n                                        >\r\n                                            {alertOn ? <BellOff className=\"w-3.5 h-3.5\" /> : <Bell className=\"w-3.5 h-3.5\" />}\r\n                                        </Button>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3519, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/hooks/useDashboard.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport useAuthStore from \"@/stores/authStore\";\r\nimport useDashboardFiltersStore from \"@/stores/dashboardFiltersStore\";\r\nimport useDashboardDataStore from \"@/stores/dashboardDataStore\";\r\nimport type { Party } from \"../types\";\r\n\r\nconst TIME_WINDOW_ANY = \"any\";\r\n\r\nexport function useDashboard() {\r\n  const { user, loading } = useAuthStore();\r\n  const router = useRouter();\r\n\r\n  const refreshProfile = useDashboardDataStore((state) => state.refreshProfile);\r\n  const refreshParties = useDashboardDataStore((state) => state.refreshParties);\r\n  const resetDashboard = useDashboardDataStore((state) => state.reset);\r\n  const welcomeName = useDashboardDataStore((state) => state.welcomeName);\r\n  const isCheckingProfile = useDashboardDataStore((state) => state.isCheckingProfile);\r\n  const partiesLoading = useDashboardDataStore((state) => state.partiesLoading);\r\n  const parties = useDashboardDataStore((state) => state.parties);\r\n  const [hasActiveParty, setHasActiveParty] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (loading) return;\r\n\r\n    if (!user) {\r\n      resetDashboard();\r\n      router.push(\"/login\");\r\n      return;\r\n    }\r\n\r\n    let cancelled = false;\r\n\r\n    (async () => {\r\n      const profileStatus = await refreshProfile();\r\n      if (cancelled) return;\r\n\r\n      if (profileStatus === \"needs-onboarding\") {\r\n        router.push(\"/user-create\");\r\n        return;\r\n      }\r\n\r\n      if (profileStatus === \"error\") {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      if (profileStatus === \"ok\") {\r\n        await refreshParties();\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [loading, user, refreshProfile, refreshParties, router, resetDashboard]);\r\n\r\n  useEffect(() => {\r\n    if (!user || loading) return;\r\n\r\n    const interval = setInterval(() => {\r\n      refreshParties();\r\n    }, 30000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [user, loading, refreshParties]);\r\n\r\n  useEffect(() => {\r\n    if (!user || partiesLoading) {\r\n      setHasActiveParty(false);\r\n      return;\r\n    }\r\n    const active = parties.some((party) => {\r\n      const isHost = party.host_id === user.id;\r\n      const isMember = party.user_is_member;\r\n      const notExpired = party.expires_at && party.expires_at.getTime() > Date.now();\r\n      return notExpired && (isHost || isMember);\r\n    });\r\n    setHasActiveParty(active);\r\n  }, [parties, partiesLoading, user]);\r\n\r\n  const isLoading = loading || isCheckingProfile || partiesLoading;\r\n\r\n  return {\r\n    welcomeName,\r\n    isLoading,\r\n    hasActiveParty,\r\n  };\r\n}\r\n\r\nexport function useDashboardParties() {\r\n  const parties = useDashboardDataStore((state) => state.parties);\r\n  const viewerUniversity = useDashboardDataStore((state) => state.viewerUniversity);\r\n  const partiesLoading = useDashboardDataStore((state) => state.partiesLoading);\r\n\r\n  const destinationQuery = useDashboardFiltersStore((state) => state.destinationQuery);\r\n  const timeWindowMins = useDashboardFiltersStore((state) => state.timeWindowMins);\r\n  const showFriendsOnly = useDashboardFiltersStore((state) => state.showFriendsOnly);\r\n  const showMyUniversityOnly = useDashboardFiltersStore((state) => state.showMyUniversityOnly);\r\n\r\n  const filteredParties = useMemo(() => {\r\n    return filterParties(parties, {\r\n      destinationQuery,\r\n      timeWindowMins,\r\n      showFriendsOnly,\r\n      showMyUniversityOnly,\r\n    }, viewerUniversity);\r\n  }, [parties, destinationQuery, timeWindowMins, showFriendsOnly, showMyUniversityOnly, viewerUniversity]);\r\n\r\n  const orderedParties = useMemo(() => {\r\n    return orderParties(filteredParties, viewerUniversity);\r\n  }, [filteredParties, viewerUniversity]);\r\n\r\n  return {\r\n    filteredParties,\r\n    orderedParties,\r\n    partiesLoading,\r\n  };\r\n}\r\n\r\ninterface FilterArgs {\r\n  destinationQuery: string;\r\n  timeWindowMins: string;\r\n  showFriendsOnly: boolean;\r\n  showMyUniversityOnly: boolean;\r\n}\r\n\r\nfunction filterParties(\r\n  parties: Party[],\r\n  filters: FilterArgs,\r\n  viewerUniversity: string | null,\r\n) {\r\n  const query = filters.destinationQuery.trim().toLowerCase();\r\n  const maxMs = filters.timeWindowMins === TIME_WINDOW_ANY\r\n    ? Infinity\r\n    : parseInt(filters.timeWindowMins, 10) * 60_000;\r\n  const now = Date.now();\r\n\r\n  return parties.filter((party) => {\r\n    const matchesDestination =\r\n      query === \"\" ||\r\n      party.drop_off.toLowerCase().includes(query) ||\r\n      party.meetup_point.toLowerCase().includes(query);\r\n\r\n    const timeLeft = party.expires_at.getTime() - now;\r\n    const matchesTime = maxMs === Infinity || (timeLeft > 0 && timeLeft <= maxMs);\r\n\r\n    const matchesFriends = !filters.showFriendsOnly || party.is_friends_only;\r\n    const matchesUniversity = !filters.showMyUniversityOnly || (\r\n      viewerUniversity && party.host_university === viewerUniversity\r\n    );\r\n\r\n    return matchesDestination && matchesTime && matchesFriends && matchesUniversity;\r\n  });\r\n}\r\n\r\nfunction orderParties(filteredParties: Party[], viewerUniversity: string | null) {\r\n  const friends: Party[] = [];\r\n  const sameUniversity: Party[] = [];\r\n  const others: Party[] = [];\r\n\r\n  for (const party of filteredParties) {\r\n    if (party.is_friends_only) {\r\n      friends.push(party);\r\n      continue;\r\n    }\r\n\r\n    const sameSchool = Boolean(\r\n      viewerUniversity &&\r\n      party.host_university &&\r\n      party.display_university &&\r\n      party.host_university === viewerUniversity,\r\n    );\r\n\r\n    if (sameSchool) {\r\n      sameUniversity.push(party);\r\n    } else {\r\n      others.push(party);\r\n    }\r\n  }\r\n\r\n  return [...friends, ...sameUniversity, ...others];\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3689, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/RidesList.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport DashboardPartyCard from \"./DashboardPartyCard\";\r\nimport { useDashboardParties } from \"../hooks/useDashboard\";\r\n\r\nexport default function RidesList() {\r\n  const { orderedParties, partiesLoading } = useDashboardParties();\r\n\r\n  if (partiesLoading) {\r\n    return (\r\n      <div className=\"bg-card p-6 rounded-lg shadow-md\">\r\n        <h2 className=\"text-2xl font-semibold text-card-foreground mb-4\">Available Rides</h2>\r\n  <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4\">\r\n          {[...Array(3)].map((_, i) => (\r\n            <div key={i} className=\"animate-pulse\">\r\n              <div className=\"h-32 bg-card/60 backdrop-blur-[6.2px] rounded-lg\" \r\n                   style={{\r\n                       boxShadow: '0 4px 30px rgba(0, 0, 0, 0.1)',\r\n                       border: '1px solid rgba(255, 255, 255, 0.1)'\r\n                   }}></div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Filter out expired parties\r\n  const now = Date.now();\r\n  const activeParties = orderedParties.filter(\r\n    (party) => party.expires_at && party.expires_at.getTime() > now\r\n  );\r\n\r\n  return (\r\n    <div className=\" relative z-0\">\r\n      <h2 className=\"text-2xl font-semibold text-card-foreground mb-4\">Available Rides</h2>\r\n\r\n      {activeParties.length === 0 ? (\r\n        <EmptyRidesState />\r\n      ) : (\r\n        <div className=\"flex flex-wrap gap-4\">\r\n          {activeParties.map((party) => (\r\n            <DashboardPartyCard key={party.id} party={party} />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction EmptyRidesState() {\r\n  return (\r\n    <div className=\"text-center py-10 border-2 border-dashed border-border rounded-lg\">\r\n      <p className=\"text-muted-foreground mb-4\">\r\n        No rides match your filters right now.\r\n      </p>\r\n      <Link\r\n        href=\"/hostparty\"\r\n        className=\"inline-block px-6 py-2 bg-primary text-primary-foreground font-semibold rounded-lg hover:bg-primary/90 transition-colors duration-300 shadow\"\r\n      >\r\n        Host a Ride\r\n      </Link>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS;IACtB,MAAM,EAAE,cAAc,EAAE,cAAc,EAAE,GAAG,CAAA,GAAA,4JAAA,CAAA,sBAAmB,AAAD;IAE7D,IAAI,gBAAgB;QAClB,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAAmD;;;;;;8BACvE,8OAAC;oBAAI,WAAU;8BACN;2BAAI,MAAM;qBAAG,CAAC,GAAG,CAAC,CAAC,GAAG,kBACrB,8OAAC;4BAAY,WAAU;sCACrB,cAAA,8OAAC;gCAAI,WAAU;gCACV,OAAO;oCACH,WAAW;oCACX,QAAQ;gCACZ;;;;;;2BALG;;;;;;;;;;;;;;;;IAWpB;IAEA,6BAA6B;IAC7B,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,gBAAgB,eAAe,MAAM,CACzC,CAAC,QAAU,MAAM,UAAU,IAAI,MAAM,UAAU,CAAC,OAAO,KAAK;IAG9D,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;0BAAmD;;;;;;YAEhE,cAAc,MAAM,KAAK,kBACxB,8OAAC;;;;qCAED,8OAAC;gBAAI,WAAU;0BACZ,cAAc,GAAG,CAAC,CAAC,sBAClB,8OAAC,wKAAA,CAAA,UAAkB;wBAAgB,OAAO;uBAAjB,MAAM,EAAE;;;;;;;;;;;;;;;;AAM7C;AAEA,SAAS;IACP,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAE,WAAU;0BAA6B;;;;;;0BAG1C,8OAAC,4JAAA,CAAA,UAAI;gBACH,MAAK;gBACL,WAAU;0BACX;;;;;;;;;;;;AAKP","debugId":null}},
    {"offset": {"line": 3820, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/LoadingScreen.tsx"],"sourcesContent":["interface LoadingScreenProps {\r\n  message?: string;\r\n}\r\n\r\nexport default function LoadingScreen({ message = \"Loading your dashboard...\" }: LoadingScreenProps) {\r\n  return (\r\n    <div className=\"flex items-center justify-center min-h-screen\">\r\n      <div className=\"text-center\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n        <p className=\"text-xl text-muted-foreground\">{message}</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAIe,SAAS,cAAc,EAAE,UAAU,2BAA2B,EAAsB;IACjG,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;;;;;;8BACf,8OAAC;oBAAE,WAAU;8BAAiC;;;;;;;;;;;;;;;;;AAItD","debugId":null}},
    {"offset": {"line": 3862, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/services/soiMemberService.ts"],"sourcesContent":["import { createClient } from \"@/utils/supabase/client\";\r\nimport type { SoiMember } from \"../types\";\r\n\r\nexport class SoiMemberService {\r\n  private supabase = createClient();\r\n\r\n  async join(soiId: number): Promise<{ success: boolean; error?: string; member?: SoiMember }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) return { success: false, error: \"Not authenticated\" };\r\n\r\n      const { data: existing, error: existingError } = await this.supabase\r\n        .from('soi_members')\r\n        .select('*')\r\n        .eq('soi_id', soiId)\r\n        .eq('user_id', user.id)\r\n        .maybeSingle();\r\n\r\n      if (existingError && existingError.code !== 'PGRST116') {\r\n        return { success: false, error: existingError.message };\r\n      }\r\n\r\n      let activeRow = existing;\r\n\r\n      if (existing?.status === 'joined') {\r\n        // Already joined; nothing to change\r\n      } else if (existing) {\r\n        const { data: updated, error: updateError } = await this.supabase\r\n          .from('soi_members')\r\n          .update({ status: 'joined', left_at: null, joined_at: new Date().toISOString() })\r\n          .eq('id', existing.id)\r\n          .select()\r\n          .single();\r\n        if (updateError || !updated) {\r\n          return { success: false, error: updateError?.message || 'Failed to re-join SOI' };\r\n        }\r\n        activeRow = updated;\r\n      } else {\r\n        const { data: inserted, error: insertError } = await this.supabase\r\n          .from('soi_members')\r\n          .insert({ soi_id: soiId, user_id: user.id, status: 'joined' })\r\n          .select()\r\n          .single();\r\n        if (insertError || !inserted) {\r\n          const message = insertError?.message || 'Failed to join';\r\n          if (message.includes('duplicate key value')) {\r\n            return { success: false, error: 'You are already marked as interested in this SOI.' };\r\n          }\r\n          return { success: false, error: message };\r\n        }\r\n        activeRow = inserted;\r\n      }\r\n\r\n      if (!activeRow) {\r\n        return { success: false, error: 'Failed to join SOI' };\r\n      }\r\n\r\n      let profile: Record<string, any> | null = null;\r\n      const { data: profileRow } = await this.supabase\r\n        .from('profiles')\r\n        .select('id, full_name, nickname, avatar_url, gender, points, university, show_university, created_at, updated_at, birth_date')\r\n        .eq('id', activeRow.user_id)\r\n        .maybeSingle();\r\n      if (profileRow) {\r\n        profile = {\r\n          ...profileRow,\r\n          created_at: profileRow.created_at ? new Date(profileRow.created_at) : null,\r\n          updated_at: profileRow.updated_at ? new Date(profileRow.updated_at) : null,\r\n          birth_date: profileRow.birth_date ? new Date(profileRow.birth_date) : null,\r\n        };\r\n      }\r\n\r\n      const transformed: SoiMember = {\r\n        ...activeRow,\r\n        joined_at: activeRow.joined_at ? new Date(activeRow.joined_at) : new Date(),\r\n        left_at: activeRow.left_at ? new Date(activeRow.left_at) : undefined,\r\n        created_at: activeRow.created_at ? new Date(activeRow.created_at) : undefined,\r\n        updated_at: activeRow.updated_at ? new Date(activeRow.updated_at) : undefined,\r\n        profile: profile || undefined,\r\n      };\r\n      return { success: true, member: transformed };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Join failed' };\r\n    }\r\n  }\r\n\r\n  async leave(soiId: number): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) return { success: false, error: \"Not authenticated\" };\r\n      const { error } = await this.supabase\r\n        .from('soi_members')\r\n        .update({ status: 'left', left_at: new Date().toISOString() })\r\n        .eq('soi_id', soiId)\r\n        .eq('user_id', user.id)\r\n        .eq('status', 'joined');\r\n      if (error) return { success: false, error: error.message };\r\n      return { success: true };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Leave failed' };\r\n    }\r\n  }\r\n}\r\n\r\nexport const soiMemberService = new SoiMemberService();\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3987, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/services/soiPartyService.ts"],"sourcesContent":["import { createClient } from \"@/utils/supabase/client\";\r\n\r\nexport class SoiPartyService {\r\n  private supabase = createClient();\r\n\r\n  async cancel(soiId: number): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      const { data: { user } } = await this.supabase.auth.getUser();\r\n      if (!user) return { success: false, error: \"Not authenticated\" };\r\n\r\n      const { error } = await this.supabase\r\n        .from('soi_parties')\r\n        .update({ is_active: false })\r\n        .eq('id', soiId)\r\n        .eq('host_id', user.id)\r\n        .eq('is_active', true);\r\n      if (error) return { success: false, error: error.message };\r\n      return { success: true };\r\n    } catch (e: any) {\r\n      return { success: false, error: e?.message || 'Cancel failed' };\r\n    }\r\n  }\r\n}\r\n\r\nexport const soiPartyService = new SoiPartyService();\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM;IACH,WAAW,CAAA,GAAA,kIAAA,CAAA,eAAY,AAAD,IAAI;IAElC,MAAM,OAAO,KAAa,EAAiD;QACzE,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO;YAC3D,IAAI,CAAC,MAAM,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAoB;YAE/D,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,CAAC,QAAQ,CAClC,IAAI,CAAC,eACL,MAAM,CAAC;gBAAE,WAAW;YAAM,GAC1B,EAAE,CAAC,MAAM,OACT,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,EAAE,CAAC,aAAa;YACnB,IAAI,OAAO,OAAO;gBAAE,SAAS;gBAAO,OAAO,MAAM,OAAO;YAAC;YACzD,OAAO;gBAAE,SAAS;YAAK;QACzB,EAAE,OAAO,GAAQ;YACf,OAAO;gBAAE,SAAS;gBAAO,OAAO,GAAG,WAAW;YAAgB;QAChE;IACF;AACF;AAEO,MAAM,kBAAkB,IAAI","debugId":null}},
    {"offset": {"line": 4025, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/SoiList.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useCallback, useEffect, useState } from \"react\";\r\nimport { createClient } from \"@/utils/supabase/client\";\r\nimport type { SoiParty } from \"../types\";\r\nimport { soiMemberService } from \"../services/soiMemberService\";\r\nimport { soiPartyService } from \"../services/soiPartyService\";\r\nimport { toast } from \"sonner\";\r\n\r\nfunction formatCountdown(target?: Date | null) {\r\n  if (!target) return \"\";\r\n  const now = new Date().getTime();\r\n  const diff = new Date(target).getTime() - now;\r\n  if (diff <= 0) return \"starting now\";\r\n  const mins = Math.floor(diff / 60000);\r\n  if (mins < 60) return `${mins}m`;\r\n  const hrs = Math.floor(mins / 60);\r\n  const rem = mins % 60;\r\n  return `${hrs}h ${rem}m`;\r\n}\r\n\r\nexport default function SoiList() {\r\n  const supabase = createClient();\r\n  const [items, setItems] = useState<SoiParty[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [now, setNow] = useState(Date.now());\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const id = setInterval(() => setNow(Date.now()), 30_000);\r\n    return () => clearInterval(id);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      setUserId(user?.id ?? null);\r\n    })();\r\n  }, [supabase]);\r\n\r\n  const fetchSOIs = useCallback(async (options?: { silent?: boolean }) => {\r\n    const silent = options?.silent ?? false;\r\n    if (!silent) setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"soi_parties\")\r\n        .select(\"*\")\r\n        .eq(\"is_active\", true)\r\n        .gte(\"start_time\", new Date(Date.now() - 10 * 60 * 1000).toISOString())\r\n        .order(\"start_time\", { ascending: true });\r\n\r\n      if (error) {\r\n        setError(error.message);\r\n        return;\r\n      }\r\n\r\n      const list: SoiParty[] = (data || []).map((r: any) => ({\r\n        id: r.id,\r\n        created_at: new Date(r.created_at),\r\n        host_id: r.host_id,\r\n        party_size: r.party_size,\r\n        meetup_point: r.meetup_point,\r\n        drop_off: r.drop_off,\r\n        ride_options: r.ride_options || [],\r\n        start_time: new Date(r.start_time),\r\n        expiry_timestamp: r.expiry_timestamp ? new Date(r.expiry_timestamp) : null,\r\n        host_university: r.host_university,\r\n        display_university: Boolean(r.display_university),\r\n        is_active: r.is_active,\r\n      } as SoiParty));\r\n\r\n      const soiIds = list.map((item) => String(item.id));\r\n      const membershipSet = new Set<string>();\r\n      const membersBySoi = new Map<string, Array<{ user_id: string; status: string }>>();\r\n\r\n      if (soiIds.length) {\r\n        const { data: memberRows, error: memberError } = await supabase\r\n          .from(\"soi_members\")\r\n          .select(\"soi_id, user_id, status\")\r\n          .in(\"soi_id\", soiIds);\r\n\r\n        if (!memberError && memberRows) {\r\n          for (const row of memberRows) {\r\n            if (row.status === \"left\" || row.status === \"kicked\") continue;\r\n            const soiId = String(row.soi_id);\r\n            const bucket = membersBySoi.get(soiId) ?? [];\r\n            bucket.push({ user_id: row.user_id, status: row.status });\r\n            membersBySoi.set(soiId, bucket);\r\n            if (userId && row.user_id === userId) {\r\n              membershipSet.add(soiId);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      const decorated = list.map((item) => {\r\n        const viewerIsHost = Boolean(userId && userId === item.host_id);\r\n        const partyMembers = membersBySoi.get(String(item.id)) ?? [];\r\n        const hostAlreadyMember = partyMembers.some((member) => member.user_id === item.host_id);\r\n        const joinedCount = partyMembers.length;\r\n        const base = hostAlreadyMember ? 0 : 1;\r\n        return {\r\n          ...item,\r\n          current_member_count: Math.max(1, joinedCount + base),\r\n          user_is_member: viewerIsHost || membershipSet.has(String(item.id)),\r\n        } as SoiParty;\r\n      });\r\n\r\n      setItems(decorated);\r\n    } finally {\r\n      if (!silent) setLoading(false);\r\n    }\r\n  }, [supabase, userId]);\r\n\r\n  useEffect(() => {\r\n    fetchSOIs();\r\n  }, [fetchSOIs]);\r\n\r\n  const handleJoin = async (id: number) => {\r\n    const idx = items.findIndex((x) => x.id === id);\r\n    if (idx < 0) return;\r\n\r\n    const current = items[idx];\r\n    if (current.user_is_member || (userId && current.host_id === userId)) {\r\n      toast.info(\"You're already in this SOI.\");\r\n      return;\r\n    }\r\n\r\n    if ((current.current_member_count || 0) >= current.party_size) {\r\n      toast.error(\"This SOI is full.\");\r\n      return;\r\n    }\r\n\r\n    const res = await soiMemberService.join(id);\r\n    if (!res.success) {\r\n      if (res.error && res.error.toLowerCase().includes(\"already\")) {\r\n        toast.info(res.error);\r\n        const updated = [...items];\r\n        updated[idx] = { ...current, user_is_member: true };\r\n        setItems(updated);\r\n      } else {\r\n        toast.error(res.error || \"Failed to join\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    toast.success(\"Joined\");\r\n    const updated = [...items];\r\n    updated[idx] = {\r\n      ...current,\r\n      current_member_count: Math.min(\r\n        current.party_size,\r\n        (current.current_member_count || 0) + 1\r\n      ),\r\n      user_is_member: true,\r\n    };\r\n    setItems(updated);\r\n    fetchSOIs({ silent: true });\r\n  };\r\n\r\n  const handleLeave = async (id: number) => {\r\n    const idx = items.findIndex((x) => x.id === id);\r\n    if (idx < 0) return;\r\n\r\n    const current = items[idx];\r\n    if (!current.user_is_member) {\r\n      toast.info(\"You're not part of this SOI.\");\r\n      return;\r\n    }\r\n\r\n    const res = await soiMemberService.leave(id);\r\n    if (!res.success) {\r\n      toast.error(res.error || \"Failed to leave\");\r\n      return;\r\n    }\r\n\r\n    toast.success(\"Left\");\r\n    const updated = [...items];\r\n    updated[idx] = {\r\n      ...current,\r\n      current_member_count: Math.max(1, (current.current_member_count || 1) - 1),\r\n      user_is_member: false,\r\n    };\r\n    setItems(updated);\r\n    fetchSOIs({ silent: true });\r\n  };\r\n\r\n  const handleCancel = async (id: number) => {\r\n    if (!confirm('Cancel this SOI? This will close it for everyone.')) return;\r\n    const res = await soiPartyService.cancel(id);\r\n    if (!res.success) return toast.error(res.error || 'Failed to cancel SOI');\r\n    toast.success('SOI canceled');\r\n    setItems((prev) => prev.filter((x) => x.id !== id));\r\n    fetchSOIs({ silent: true });\r\n  };\r\n\r\n  if (loading) return <div className=\"text-sm text-muted-foreground\">Loading upcoming rides</div>;\r\n  if (error) return <div className=\"text-sm text-destructive\">{error}</div>;\r\n  if (!items.length) return <div className=\"text-sm text-muted-foreground\">No upcoming rides.</div>;\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-6\">\r\n      {items.map((s) => {\r\n        const full = (s.current_member_count || 0) >= s.party_size;\r\n        const countdown = formatCountdown(s.start_time);\r\n        const isHost = userId && userId === s.host_id;\r\n        const isMember = Boolean(s.user_is_member);\r\n        return (\r\n          <div key={s.id} className=\"bg-card border rounded-lg p-4 flex flex-col gap-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"font-semibold text-card-foreground\">{s.meetup_point}</div>\r\n              <div className=\"text-xs text-muted-foreground\">Starts in {countdown}</div>\r\n            </div>\r\n            <div className=\"text-sm text-muted-foreground\"> {s.drop_off}</div>\r\n            <div className=\"text-xs text-muted-foreground\">{(s.ride_options || []).join(\", \")}</div>\r\n            <div className=\"text-sm\">{s.current_member_count}/{s.party_size} interested</div>\r\n            <div className=\"mt-2 flex gap-3\">\r\n              {isHost ? (\r\n                <button\r\n                  className=\"px-4 py-2 rounded-md text-sm border border-destructive text-destructive hover:bg-destructive/10\"\r\n                  onClick={() => handleCancel(s.id)}\r\n                >\r\n                  Cancel SOI\r\n                </button>\r\n              ) : (\r\n                <>\r\n                  {!isMember ? (\r\n                    <button\r\n                      className={`px-4 py-2 rounded-md text-sm ${full ? \"bg-muted text-muted-foreground cursor-not-allowed\" : \"bg-primary text-primary-foreground hover:bg-primary/90\"}`}\r\n                      disabled={full}\r\n                      onClick={() => handleJoin(s.id)}\r\n                    >\r\n                      {full ? \"SOI full\" : \"I'm in\"}\r\n                    </button>\r\n                  ) : (\r\n                    <button\r\n                      className=\"px-4 py-2 rounded-md text-sm border border-destructive text-destructive hover:bg-destructive/10\"\r\n                      onClick={() => handleLeave(s.id)}\r\n                    >\r\n                      I've changed my mind\r\n                    </button>\r\n                  )}\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4369, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/components/CurrentPartySection.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useCallback, useEffect, useState } from \"react\";\r\nimport { MapPin } from \"lucide-react\";\r\nimport useAuthStore from \"@/stores/authStore\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { partyMemberService } from \"../services/partyMemberService\";\r\nimport { useNotificationsStore } from \"@/stores/notificationsStore\";\r\n\r\ninterface RequestRow {\r\n  id: string;\r\n  party_id: string;\r\n  user_id: string;\r\n  created_at: Date;\r\n  party?: {\r\n    drop_off: string | null;\r\n    meetup_point: string | null;\r\n  } | null;\r\n  userProfile?: {\r\n    id: string;\r\n    nickname: string | null;\r\n    full_name: string | null;\r\n    avatar_url: string | null;\r\n    gender: string | null;\r\n    university: string | null;\r\n  } | null;\r\n}\r\n\r\nexport default function CurrentPartySection() {\r\n  const user = useAuthStore((s) => s.user);\r\n  const [loading, setLoading] = useState(true);\r\n  const [requests, setRequests] = useState<RequestRow[]>([]);\r\n  const [busyIds, setBusyIds] = useState<string[]>([]);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const addNotification = useNotificationsStore((s) => s.add);\r\n  const hasNotification = useNotificationsStore((s) => s.has);\r\n  const removeNotification = useNotificationsStore((s) => s.remove);\r\n\r\n  const pushNotificationsForRequests = useCallback((items: RequestRow[]) => {\r\n    items.forEach((request) => {\r\n      const notifId = `join-request:${request.id}`;\r\n      if (hasNotification(notifId)) return;\r\n\r\n      const riderName = request.userProfile?.nickname || request.userProfile?.full_name || \"A rider\";\r\n      const destination = request.party?.drop_off ? ` to ${request.party.drop_off}` : \"\";\r\n\r\n      addNotification({\r\n        id: notifId,\r\n        message: `${riderName} wants to join your party${destination}`,\r\n        timestamp: request.created_at instanceof Date ? request.created_at : new Date(request.created_at),\r\n        read: false,\r\n        type: \"join_request\",\r\n        meta: {\r\n          requestId: request.id,\r\n          partyId: request.party_id,\r\n          requesterId: request.user_id,\r\n          requesterName: riderName,\r\n        },\r\n      });\r\n    });\r\n  }, [addNotification, hasNotification]);\r\n\r\n  const loadRequests = useCallback(async () => {\r\n    if (!user) {\r\n      setRequests([]);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await partyMemberService.getPendingRequestsForHost();\r\n    if (!result.success) {\r\n      setRequests([]);\r\n      setError(result.error ?? \"Failed to load requests\");\r\n    } else {\r\n      const pending = result.requests ?? [];\r\n      setRequests(pending);\r\n      pushNotificationsForRequests(pending);\r\n    }\r\n    setLoading(false);\r\n  }, [user, pushNotificationsForRequests]);\r\n\r\n  useEffect(() => {\r\n    loadRequests();\r\n  }, [loadRequests]);\r\n\r\n  const handleApprove = useCallback(async (request: RequestRow) => {\r\n    setBusyIds((ids) => [...ids, request.id]);\r\n    const result = await partyMemberService.approveRequest(request.id, request.party_id, request.user_id);\r\n    if (!result.success) {\r\n      setError(result.error ?? \"Failed to approve request\");\r\n    }\r\n    await loadRequests();\r\n    setBusyIds((ids) => ids.filter((id) => id !== request.id));\r\n    if (result.success) {\r\n      removeNotification(`join-request:${request.id}`);\r\n    }\r\n  }, [loadRequests, removeNotification]);\r\n\r\n  const handleDecline = useCallback(async (request: RequestRow) => {\r\n    setBusyIds((ids) => [...ids, request.id]);\r\n    const result = await partyMemberService.declineRequest(request.id);\r\n    if (!result.success) {\r\n      setError(result.error ?? \"Failed to decline request\");\r\n    }\r\n    await loadRequests();\r\n    setBusyIds((ids) => ids.filter((id) => id !== request.id));\r\n    if (result.success) {\r\n      removeNotification(`join-request:${request.id}`);\r\n    }\r\n  }, [loadRequests, removeNotification]);\r\n\r\n  const getInitials = (profile?: RequestRow[\"userProfile\"]) => {\r\n    const base = profile?.nickname || profile?.full_name || \"?\";\r\n    return base\r\n      .split(\" \")\r\n      .map((part) => part[0])\r\n      .join(\"\")\r\n      .slice(0, 2)\r\n      .toUpperCase();\r\n  };\r\n\r\n  if (loading) {\r\n    return null;\r\n  }\r\n\r\n  if (!error && requests.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <h2 className=\"text-2xl font-semibold text-card-foreground mb-4\">Current Party Requests</h2>\r\n      {error ? (\r\n        <Card><CardContent className=\"p-6 text-sm text-rose-600\">{error}</CardContent></Card>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 gap-3\">\r\n          {requests.map((request) => {\r\n            const partyDescription = request.party?.drop_off || \"destination\";\r\n            const meetup = request.party?.meetup_point || \"Meetup TBD\";\r\n            const profile = request.userProfile;\r\n            const busy = busyIds.includes(request.id);\r\n\r\n            return (\r\n              <Card key={request.id}>\r\n                <CardContent className=\"p-4 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <Avatar className=\"h-10 w-10\">\r\n                      {profile?.avatar_url ? (\r\n                        <AvatarImage src={profile.avatar_url} alt={profile?.nickname || profile?.full_name || \"Rider\"} />\r\n                      ) : (\r\n                        <AvatarFallback>{getInitials(profile)}</AvatarFallback>\r\n                      )}\r\n                    </Avatar>\r\n                    <div className=\"space-y-1\">\r\n                      <div className=\"text-sm font-medium\">\r\n                        {profile?.nickname || profile?.full_name || \"Rider\"}\r\n                      </div>\r\n                      {profile?.university ? (\r\n                        <div className=\"text-xs text-muted-foreground\">{profile.university}</div>\r\n                      ) : null}\r\n                      <div className=\"text-xs text-muted-foreground flex items-center gap-2\">\r\n                        <MapPin className=\"h-3.5 w-3.5\" /> {meetup}\r\n                      </div>\r\n                      <div className=\"text-xs text-muted-foreground\">Heading to {partyDescription}</div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"flex gap-2\">\r\n                    <Button variant=\"outline\" size=\"sm\" disabled={busy} onClick={() => handleDecline(request)}>\r\n                      Decline\r\n                    </Button>\r\n                    <Button size=\"sm\" disabled={busy} onClick={() => handleApprove(request)}>\r\n                      {busy ? \"Processing\" : \"Approve\"}\r\n                    </Button>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;;;;;;;;;;AA8Be,SAAS;IACtB,MAAM,OAAO,CAAA,GAAA,0HAAA,CAAA,UAAY,AAAD,EAAE,CAAC,IAAM,EAAE,IAAI;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAgB,EAAE;IACzD,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAY,EAAE;IACnD,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,kBAAkB,CAAA,GAAA,mIAAA,CAAA,wBAAqB,AAAD,EAAE,CAAC,IAAM,EAAE,GAAG;IAC1D,MAAM,kBAAkB,CAAA,GAAA,mIAAA,CAAA,wBAAqB,AAAD,EAAE,CAAC,IAAM,EAAE,GAAG;IAC1D,MAAM,qBAAqB,CAAA,GAAA,mIAAA,CAAA,wBAAqB,AAAD,EAAE,CAAC,IAAM,EAAE,MAAM;IAEhE,MAAM,+BAA+B,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE,CAAC;QAChD,MAAM,OAAO,CAAC,CAAC;YACb,MAAM,UAAU,CAAC,aAAa,EAAE,QAAQ,EAAE,EAAE;YAC5C,IAAI,gBAAgB,UAAU;YAE9B,MAAM,YAAY,QAAQ,WAAW,EAAE,YAAY,QAAQ,WAAW,EAAE,aAAa;YACrF,MAAM,cAAc,QAAQ,KAAK,EAAE,WAAW,CAAC,IAAI,EAAE,QAAQ,KAAK,CAAC,QAAQ,EAAE,GAAG;YAEhF,gBAAgB;gBACd,IAAI;gBACJ,SAAS,GAAG,UAAU,yBAAyB,EAAE,aAAa;gBAC9D,WAAW,QAAQ,UAAU,YAAY,OAAO,QAAQ,UAAU,GAAG,IAAI,KAAK,QAAQ,UAAU;gBAChG,MAAM;gBACN,MAAM;gBACN,MAAM;oBACJ,WAAW,QAAQ,EAAE;oBACrB,SAAS,QAAQ,QAAQ;oBACzB,aAAa,QAAQ,OAAO;oBAC5B,eAAe;gBACjB;YACF;QACF;IACF,GAAG;QAAC;QAAiB;KAAgB;IAErC,MAAM,eAAe,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QAC/B,IAAI,CAAC,MAAM;YACT,YAAY,EAAE;YACd,WAAW;YACX;QACF;QAEA,WAAW;QACX,SAAS;QACT,MAAM,SAAS,MAAM,qKAAA,CAAA,qBAAkB,CAAC,yBAAyB;QACjE,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,YAAY,EAAE;YACd,SAAS,OAAO,KAAK,IAAI;QAC3B,OAAO;YACL,MAAM,UAAU,OAAO,QAAQ,IAAI,EAAE;YACrC,YAAY;YACZ,6BAA6B;QAC/B;QACA,WAAW;IACb,GAAG;QAAC;QAAM;KAA6B;IAEvC,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR;IACF,GAAG;QAAC;KAAa;IAEjB,MAAM,gBAAgB,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE,OAAO;QACvC,WAAW,CAAC,MAAQ;mBAAI;gBAAK,QAAQ,EAAE;aAAC;QACxC,MAAM,SAAS,MAAM,qKAAA,CAAA,qBAAkB,CAAC,cAAc,CAAC,QAAQ,EAAE,EAAE,QAAQ,QAAQ,EAAE,QAAQ,OAAO;QACpG,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,SAAS,OAAO,KAAK,IAAI;QAC3B;QACA,MAAM;QACN,WAAW,CAAC,MAAQ,IAAI,MAAM,CAAC,CAAC,KAAO,OAAO,QAAQ,EAAE;QACxD,IAAI,OAAO,OAAO,EAAE;YAClB,mBAAmB,CAAC,aAAa,EAAE,QAAQ,EAAE,EAAE;QACjD;IACF,GAAG;QAAC;QAAc;KAAmB;IAErC,MAAM,gBAAgB,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE,OAAO;QACvC,WAAW,CAAC,MAAQ;mBAAI;gBAAK,QAAQ,EAAE;aAAC;QACxC,MAAM,SAAS,MAAM,qKAAA,CAAA,qBAAkB,CAAC,cAAc,CAAC,QAAQ,EAAE;QACjE,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,SAAS,OAAO,KAAK,IAAI;QAC3B;QACA,MAAM;QACN,WAAW,CAAC,MAAQ,IAAI,MAAM,CAAC,CAAC,KAAO,OAAO,QAAQ,EAAE;QACxD,IAAI,OAAO,OAAO,EAAE;YAClB,mBAAmB,CAAC,aAAa,EAAE,QAAQ,EAAE,EAAE;QACjD;IACF,GAAG;QAAC;QAAc;KAAmB;IAErC,MAAM,cAAc,CAAC;QACnB,MAAM,OAAO,SAAS,YAAY,SAAS,aAAa;QACxD,OAAO,KACJ,KAAK,CAAC,KACN,GAAG,CAAC,CAAC,OAAS,IAAI,CAAC,EAAE,EACrB,IAAI,CAAC,IACL,KAAK,CAAC,GAAG,GACT,WAAW;IAChB;IAEA,IAAI,SAAS;QACX,OAAO;IACT;IAEA,IAAI,CAAC,SAAS,SAAS,MAAM,KAAK,GAAG;QACnC,OAAO;IACT;IAEA,qBACE,8OAAC;;0BACC,8OAAC;gBAAG,WAAU;0BAAmD;;;;;;YAChE,sBACC,8OAAC,gIAAA,CAAA,OAAI;0BAAC,cAAA,8OAAC,gIAAA,CAAA,cAAW;oBAAC,WAAU;8BAA6B;;;;;;;;;;qCAE1D,8OAAC;gBAAI,WAAU;0BACZ,SAAS,GAAG,CAAC,CAAC;oBACb,MAAM,mBAAmB,QAAQ,KAAK,EAAE,YAAY;oBACpD,MAAM,SAAS,QAAQ,KAAK,EAAE,gBAAgB;oBAC9C,MAAM,UAAU,QAAQ,WAAW;oBACnC,MAAM,OAAO,QAAQ,QAAQ,CAAC,QAAQ,EAAE;oBAExC,qBACE,8OAAC,gIAAA,CAAA,OAAI;kCACH,cAAA,8OAAC,gIAAA,CAAA,cAAW;4BAAC,WAAU;;8CACrB,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,kIAAA,CAAA,SAAM;4CAAC,WAAU;sDACf,SAAS,2BACR,8OAAC,kIAAA,CAAA,cAAW;gDAAC,KAAK,QAAQ,UAAU;gDAAE,KAAK,SAAS,YAAY,SAAS,aAAa;;;;;qEAEtF,8OAAC,kIAAA,CAAA,iBAAc;0DAAE,YAAY;;;;;;;;;;;sDAGjC,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;8DACZ,SAAS,YAAY,SAAS,aAAa;;;;;;gDAE7C,SAAS,2BACR,8OAAC;oDAAI,WAAU;8DAAiC,QAAQ,UAAU;;;;;2DAChE;8DACJ,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,0MAAA,CAAA,SAAM;4DAAC,WAAU;;;;;;wDAAgB;wDAAE;;;;;;;8DAEtC,8OAAC;oDAAI,WAAU;;wDAAgC;wDAAY;;;;;;;;;;;;;;;;;;;8CAI/D,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,kIAAA,CAAA,SAAM;4CAAC,SAAQ;4CAAU,MAAK;4CAAK,UAAU;4CAAM,SAAS,IAAM,cAAc;sDAAU;;;;;;sDAG3F,8OAAC,kIAAA,CAAA,SAAM;4CAAC,MAAK;4CAAK,UAAU;4CAAM,SAAS,IAAM,cAAc;sDAC5D,OAAO,gBAAgB;;;;;;;;;;;;;;;;;;uBA7BrB,QAAQ,EAAE;;;;;gBAmCzB;;;;;;;;;;;;AAKV","debugId":null}},
    {"offset": {"line": 4673, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/91971/Desktop/Projects/meet-riders/frontend/src/app/%28main%29/dashboard/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport HostButton from \"@/components/ui/hostbutton\";\r\nimport DashboardHeader from \"./components/DashboardHeader\";\r\nimport RidesList from \"./components/RidesList\";\r\nimport LoadingScreen from \"./components/LoadingScreen\";\r\nimport SoiList from \"./components/SoiList\";\r\nimport { useDashboard } from \"./hooks/useDashboard\";\r\nimport CurrentPartySection from \"./components/CurrentPartySection\";\r\n\r\nexport default function HomePage() {\r\n  const { welcomeName, isLoading, hasActiveParty } = useDashboard();\r\n\r\n  if (isLoading) {\r\n    return <LoadingScreen />;\r\n  }\r\n\r\n  return (\r\n    <div className=\" min-h-dvh p-6\">\r\n      {!hasActiveParty && <HostButton />}\r\n\r\n      <DashboardHeader\r\n        welcomeName={welcomeName}\r\n      />\r\n\r\n      <div className=\"mt-6 space-y-10\">\r\n        <CurrentPartySection />\r\n        <RidesList />\r\n\r\n        <div>\r\n          <h2 className=\"text-2xl font-semibold text-card-foreground mb-4\">Upcoming Rides (SOI)</h2>\r\n          <SoiList />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;;;;;;;;AAUe,SAAS;IACtB,MAAM,EAAE,WAAW,EAAE,SAAS,EAAE,cAAc,EAAE,GAAG,CAAA,GAAA,4JAAA,CAAA,eAAY,AAAD;IAE9D,IAAI,WAAW;QACb,qBAAO,8OAAC,mKAAA,CAAA,UAAa;;;;;IACvB;IAEA,qBACE,8OAAC;QAAI,WAAU;;YACZ,CAAC,gCAAkB,8OAAC,sIAAA,CAAA,UAAU;;;;;0BAE/B,8OAAC,qKAAA,CAAA,UAAe;gBACd,aAAa;;;;;;0BAGf,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,yKAAA,CAAA,UAAmB;;;;;kCACpB,8OAAC,+JAAA,CAAA,UAAS;;;;;kCAEV,8OAAC;;0CACC,8OAAC;gCAAG,WAAU;0CAAmD;;;;;;0CACjE,8OAAC,6JAAA,CAAA,UAAO;;;;;;;;;;;;;;;;;;;;;;;AAKlB","debugId":null}}]
}